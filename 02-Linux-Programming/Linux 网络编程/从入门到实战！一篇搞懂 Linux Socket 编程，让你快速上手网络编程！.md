# å‰è¨€ï¼šä»â€œè¿›ç¨‹å¯¹è¯â€åˆ°â€œè®¡ç®—æœºé€šè¯â€ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬èŠèŠ Socketï¼

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°åº·ã€‚

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬èŠäº†è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ï¼Œé‚£æ˜¯è®¡ç®—æœºå†…éƒ¨çš„â€œè‡ªè¨€è‡ªè¯­â€â€”â€”ä¸åŒè¿›ç¨‹ä¹‹é—´å¦‚ä½•å…±äº«ä¿¡æ¯ã€‚è€Œä»Šå¤©ï¼Œæˆ‘ä»¬è¦è¿ˆå‡ºæ›´å¤§ä¸€æ­¥ï¼š
è®©ä½ çš„ç¨‹åºï¼Œä¸ä»…èƒ½å’ŒåŒä¸€å°ç”µè„‘ä¸Šçš„å…¶ä»–è¿›ç¨‹å¯¹è¯ï¼Œè¿˜èƒ½å’Œä¸–ç•Œä¸Šä»»æ„ä¸€å°è®¡ç®—æœºâ€œæ‰“ç”µè¯â€ï¼

æ²¡é”™ï¼Œè¿™å°±æ˜¯ Socket ç¼–ç¨‹ çš„ä¸–ç•Œã€‚
å®ƒå°±åƒä¸€æ ¹çœ‹ä¸è§çš„â€œç½‘ç»œç”µè¯çº¿â€ï¼Œè®©ä¸åŒä¸»æœºã€ä¸åŒè¿›ç¨‹ä¹‹é—´å¯ä»¥å»ºç«‹è¿æ¥ã€å‘é€æ¶ˆæ¯ã€æ”¶å‘æ•°æ®ã€‚ä½ æ¯å¤©æ‰“å¼€çš„ç½‘é¡µã€ä½¿ç”¨çš„å¾®ä¿¡ã€æ’­æ”¾çš„éŸ³ä¹ï¼Œå…¶èƒŒåéƒ½ç¦»ä¸å¼€ Socket é€šä¿¡ã€‚

å¾ˆå¤šåŒå­¦ä¸€çœ‹åˆ° â€œsocket ç¼–ç¨‹â€ å°±ä¼šè§‰å¾—å¤´ç–¼ï¼Œå¥½åƒæ¶‰åŠç½‘ç»œåè®®ã€ç«¯å£ã€å­—èŠ‚åºè¿™äº›æ™¦æ¶©éš¾æ‡‚çš„æ¦‚å¿µã€‚
ä½†å…¶å®ï¼Œåªè¦æŠ“ä½æ ¸å¿ƒåŸç†ï¼ŒSocket è¿œæ²¡æœ‰ä½ æƒ³è±¡çš„å¤æ‚ã€‚å®ƒæ›´åƒæ˜¯ä¸€ä¸ªå¯ç¼–ç¨‹çš„â€œç½‘ç»œæ’åº§â€ï¼Œä½ åªè¦çŸ¥é“æ€ä¹ˆæ’ä¸Šã€æ€ä¹ˆå‘ã€æ€ä¹ˆæ”¶ï¼Œå°±èƒ½è½»æ¾ä¸Šæ‰‹ç½‘ç»œé€šä¿¡ã€‚

> ğŸ’¡ å­¦ä¹ å»ºè®®ï¼šåˆ«åªçœ‹ï¼ŒåŠ¨æ‰‹æ•²ä»£ç ï¼æ¯ä¸€ä¸ª sendã€recvã€bind éƒ½æ˜¯ç†è§£ç½‘ç»œé€šä¿¡çš„å…³é”®ã€‚
>
> å¦‚æœåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæˆ–è€…æƒ³è·å–æ›´å¤š Linuxã€C/C++ã€Go åç«¯å¼€å‘ç­‰æŠ€æœ¯å¹²è´§ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œè·Ÿç€å°åº·å­¦ç¼–ç¨‹ã€ã€‚æœ‰é—®é¢˜ä¹Ÿå¯ä»¥æ·»åŠ æˆ‘çš„ä¸ªäººå¾®ä¿¡äº¤æµè®¨è®ºã€‚
> 
> <table>
> <tr>
> <td align="center">
> <img src="https://github.com/xiaokangcoding/follow-xiaokang-coding/raw/main/images/qrcode-wechat-official.png" width="200">
> <br>
> <em>å…¬ä¼—å·ã€Œè·Ÿç€å­¦å°åº·ç¼–ç¨‹ã€</em>
> </td>
> <td align="center">
> <img src="https://github.com/xiaokangcoding/follow-xiaokang-coding/raw/main/images/qrcode-personal-wechat.png" width="200">
> <br>
> <em>ä¸ªäººå¾®ä¿¡ï¼ˆå¤‡æ³¨ï¼šåŠ ç¾¤ï¼‰</em>
> </td>
> </tr>
> </table>

å‡†å¤‡å¥½äº†å—ï¼Ÿ

è®©æˆ‘ä»¬ä»â€œè¿›ç¨‹ä¹‹é—´çš„å¯¹è¯â€èµ°å‘â€œè®¡ç®—æœºä¹‹é—´çš„äº¤æµâ€ï¼Œä¸€èµ·æ­å¼€ Linux Socket ç¼–ç¨‹ çš„ç¥ç§˜é¢çº±å§ï¼

#### ä¸€ã€socket æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ

åˆ«æ€¥ç€å†™ä»£ç ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠï¼Œä»€ä¹ˆæ˜¯ socketï¼Ÿ

å¤§ç™½è¯æ¥è¯´ï¼Œsocket å°±åƒä½ å®¶é‡Œçš„æ’åº§ã€‚ä½ æŠŠç”µå™¨æ’è¿›å»ï¼Œé€šç”µäº†ï¼Œå®ƒå°±èƒ½å·¥ä½œã€‚socket ä¹Ÿæ˜¯ç±»ä¼¼çš„ä¸œè¥¿ï¼Œåªä¸è¿‡å®ƒè¿æ¥çš„ä¸æ˜¯ç”µï¼Œè€Œæ˜¯ç½‘ç»œæ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ socket è®©ä¸¤å°è®¡ç®—æœºè¿›è¡Œäº¤æµï¼Œæ¯”å¦‚è®©ä½ çš„ç”µè„‘å’Œè¿œç¨‹æœåŠ¡å™¨æ¡ä¸ªæ‰‹ï¼ŒèŠèŠå¤©ã€‚

å®é™…ä¸Šï¼Œ**socket å°±æ˜¯ IP åœ°å€å’Œç«¯å£å·çš„ç»„åˆï¼Œå®ƒç”¨æ¥æ ‡è¯†ç½‘ç»œä¸­çš„ä¸€ä¸ªå…·ä½“é€šä¿¡ç«¯ç‚¹**ã€‚å°±åƒæ¯ä¸ªæˆ¿å­éƒ½æœ‰ä¸€ä¸ªé—¨ç‰Œå·ï¼ˆIP åœ°å€ï¼‰å’Œé—¨ï¼ˆç«¯å£å·ï¼‰ï¼Œåªæœ‰ä¸¤è€…ç»“åˆåœ¨ä¸€èµ·ï¼Œæ‰èƒ½å”¯ä¸€æ ‡è¯†ç½‘ç»œä¸­çš„æŸä¸ªåº”ç”¨ç¨‹åºã€‚socket å¯ä»¥ç†è§£ä¸ºä½ åœ¨ç½‘ç»œä¸–ç•Œä¸­æ‰“ç”µè¯çš„â€œç”µè¯æœºâ€ã€‚ä½ æ‹¨å·ï¼Œè¿æ¥ä¸Šå¯¹æ–¹ï¼Œä¸¤ä¸ªäººå°±å¯ä»¥å¯¹è¯â€”â€”è¿™å°±æ˜¯ç½‘ç»œé€šä¿¡çš„æœ¬è´¨ï¼

### IP åœ°å€å’Œç«¯å£å·æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ç»§ç»­è®²è§£ socket ç¼–ç¨‹ä¹‹å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹ IP åœ°å€å’Œç«¯å£å·ï¼Œå¸®åŠ©ä½ æ›´å¥½ç†è§£ socket çš„å·¥ä½œåŸç†ã€‚

- **IP åœ°å€**ï¼šIP åœ°å€å°±åƒæ˜¯äº’è”ç½‘ä¸­çš„â€œé—¨ç‰Œå·â€ï¼Œå®ƒå”¯ä¸€æ ‡è¯†äº†ä¸€å°è®¾å¤‡çš„ä½ç½®ã€‚æ— è®ºæ˜¯ä½ çš„ç”µè„‘ã€æ‰‹æœºï¼Œè¿˜æ˜¯æœåŠ¡å™¨ï¼Œå®ƒä»¬éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ IP åœ°å€ï¼Œè¿™æ ·å…¶ä»–è®¾å¤‡æ‰èƒ½æ‰¾åˆ°å®ƒä»¬çš„â€œä½ç½®â€ã€‚

- **ç«¯å£å·**ï¼šç«¯å£å·å¯ä»¥ç†è§£ä¸ºæˆ¿å­ä¸­çš„â€œæˆ¿é—´å·â€ï¼Œç”¨æ¥æ ‡è¯†è®¾å¤‡ä¸Šæ­£åœ¨è¿è¡Œçš„å…·ä½“æœåŠ¡æˆ–åº”ç”¨ç¨‹åºã€‚æ¯”å¦‚è¯´ï¼Œä½ å®¶æœ‰ä¸€ä¸ªé—¨ç‰Œå·è¡¨ç¤ºä½ç½®ï¼Œä½†å®¶é‡Œçš„ä¸åŒæˆ¿é—´æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œç«¯å£å·å°±æ˜¯è¿™æ ·çš„â€œæˆ¿é—´å·â€ã€‚ä¸åŒçš„æœåŠ¡æœ‰ä¸åŒçš„ç«¯å£å·ï¼Œæ¯”å¦‚ç½‘é¡µæœåŠ¡é€šå¸¸ç”¨ 80 ç«¯å£ï¼Œè€Œå®‰å…¨çš„ HTTPS æœåŠ¡ç”¨ 443 ç«¯å£ã€‚

ç»“åˆèµ·æ¥ï¼ŒIP åœ°å€å’Œç«¯å£å·å°±åƒæ˜¯æ‰¾åˆ°æŸå°è®¾å¤‡ä¸Šå…·ä½“æœåŠ¡çš„æ–¹å¼ã€‚ä½ å»æŸä¸ªåœ°å€ï¼ˆIP åœ°å€ï¼‰æ‹œè®¿æœ‹å‹ï¼Œç„¶åæ•²å¼€ä»–å®¶çš„æŸä¸ªæˆ¿é—´é—¨ï¼ˆç«¯å£å·ï¼‰æ‰¾åˆ°ä»–ï¼Œè¿™å°±æ˜¯ IP åœ°å€å’Œç«¯å£å·çš„å·¥ä½œæ–¹å¼ã€‚

#### äºŒã€socket ç¼–ç¨‹æµç¨‹ï¼šåšä¸ªâ€œç”µè¯â€è¦å‡ æ­¥ï¼Ÿ

ç”¨ socket ç¼–ç¨‹å‘¢ï¼Œå¯ä»¥åš TCP èŠå¤©ç¨‹åºï¼Œä¹Ÿå¯ä»¥åš UDP èŠå¤©ç¨‹åºã€‚ä¸è¿‡ï¼ŒTCP æ˜¯å¤§éƒ¨åˆ†åœºæ™¯é‡Œæœ€å¸¸è§çš„â€˜é¦™é¥½é¥½â€™ï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘ä»¬ä¸»è¦æ¥èŠèŠæ€ä¹ˆæå®šä¸€ä¸ª TCP æœåŠ¡å™¨ã€‚

é¦–å…ˆï¼Œè¦è®©ä¸¤ä¸ªç¨‹åºé€šè¿‡ç½‘ç»œå¯¹è¯ï¼Œä½ å¾—å…ˆå‡†å¤‡ä¸¤ä¸ªâ€œç”µè¯æœºâ€ï¼š

1. **æœåŠ¡å™¨ç«¯**ï¼šè¿™æ˜¯æ¥ç”µè¯çš„äººï¼Œéœ€è¦ç­‰ç€åˆ«äººæ‹¨å·è”ç³»ã€‚
2. **å®¢æˆ·ç«¯**ï¼šè¿™æ˜¯æ‰“ç”µè¯çš„äººï¼Œä¸»åŠ¨æ‹¨å·ï¼Œå»ºç«‹è¿æ¥ã€‚

æ¥çœ‹å¼ å›¾ï¼š

![](https://files.mdnice.com/user/71186/2ba1c7b6-dd3a-4326-a120-319f15cae31a.png)

> **å°æç¤º**ï¼šå»ºç«‹ TCP è¿æ¥å®é™…ä¸Šæ˜¯é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å®Œæˆçš„ï¼Œå…³äºä¸‰æ¬¡æ¡æ‰‹çš„æµç¨‹ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œç™¾åº¦çœ‹çœ‹ï¼Œå¾ˆç®€å•çš„ã€‚

å°±åƒæ‰“ç”µè¯èŠå¤©ä¸€æ ·ï¼Œsocket é€šä¿¡ä¹Ÿæœ‰ä¸€å¥—æ­¥éª¤ã€‚åœ¨å…·ä½“è®²è¿™äº›æ­¥éª¤ä¹‹å‰ï¼Œå…ˆæ¥è®¤è¯†ä¸€ä¸‹å¸¸ç”¨çš„å¥—æ¥å­— APIï¼Œå…ˆæ··ä¸ªçœ¼ç†Ÿï¼Œç¨åæˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£å®ƒä»¬ã€‚

å¥—æ¥å­—å¸¸ç”¨ APIï¼š

```c
socket()                    : åˆ›å»ºå¥—æ¥å­—
bind()                      : ç»‘å®šå¥—æ¥å­—åˆ°æœ¬åœ°åœ°å€
listen()                    : ç›‘å¬ç½‘ç»œè¿æ¥
accept()                    : æ¥å—ç½‘ç»œè¿æ¥
connect()                   : è¿æ¥åˆ°è¿œç¨‹ä¸»æœº
send(), recv()              : å‘é€å’Œæ¥æ”¶æ•°æ®ï¼ˆé¢å‘è¿æ¥çš„å¥—æ¥å­—ï¼‰
sendto(), recvfrom()        : å‘é€å’Œæ¥æ”¶æ•°æ®ï¼ˆæ— è¿æ¥çš„å¥—æ¥å­—ï¼‰
close() ,shutdown()         : å…³é—­å¥—æ¥å­—
getsockopt(), setsockopt()  : è·å–å’Œè®¾ç½®å¥—æ¥å­—é€‰é¡¹
```


æ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†æ¥çœ‹ä¸‹ socket é€šä¿¡çš„å…·ä½“æ­¥éª¤,è¿™é‡Œæˆ‘åˆ†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸¤è¾¹æ¥è®²ï¼š

**æœåŠ¡å™¨ç«¯çš„åŸºæœ¬æ­¥éª¤**ï¼š

1. **åˆ›å»º socket**ï¼šå…ˆåšä¸ªâ€œç”µè¯æœºâ€ï¼Œç”¨ä»£ç æ¥è¯´å°±æ˜¯è°ƒç”¨ `socket()` å‡½æ•°ã€‚
2. **ç»‘å®šåœ°å€**ï¼šåšå‡ºæ¥çš„ç”µè¯æœºå¾—æœ‰ä¸ªâ€œå·ç â€ï¼Œä¹Ÿå°±æ˜¯IPå’Œç«¯å£å·ï¼Œç”¨ `bind()` æ¥æŒ‡å®šã€‚
3. **ç›‘å¬**ï¼š`listen()`ï¼ŒæŒ‚åœ¨é‚£å„¿ç­‰ç”µè¯ã€‚
4. **æ¥ç”µè¯**ï¼šå¦‚æœæœ‰ç”µè¯æ‰“è¿‡æ¥äº†ï¼Œå°±ç”¨ `accept()` æ¥é€šã€‚
5. **æ”¶å‘æ•°æ®**ï¼šåŒæ–¹å¯ä»¥é€šè¿‡ `send()` å’Œ `recv()` å‡½æ•°æ”¶å‘æ•°æ®ï¼Œè¿™å°±ç›¸å½“äºåŒæ–¹èŠå¤©ã€‚
6. **å…³é—­è¿æ¥**ï¼šèŠå®Œäº†ï¼Œ`close()` æŒ‚ç”µè¯ã€‚

**å®¢æˆ·ç«¯çš„åŸºæœ¬æ­¥éª¤**ï¼š

1. **åˆ›å»º socket**ï¼šè·ŸæœåŠ¡å™¨ç«¯ä¸€æ ·ï¼Œä¹Ÿå¾—å…ˆåšä¸ªç”µè¯æœºï¼Œç”¨ `socket()`ã€‚
2. **è¿æ¥æœåŠ¡å™¨**ï¼šç”¨ `connect()` å»æ‹¨å·ï¼Œç›®æ ‡æ˜¯æœåŠ¡å™¨çš„ IP å’Œç«¯å£å·ã€‚
3. **æ”¶å‘æ•°æ®**ï¼šè·ŸæœåŠ¡å™¨ä¸€æ ·ï¼Œå¯ä»¥ç”¨ `send()` å’Œ `recv()` æ¥èŠå¤©ã€‚
4. **å…³é—­è¿æ¥**ï¼šèŠå®Œäº†ï¼Œ`close()` æŒ‚ç”µè¯ã€‚

å†æ¥çœ‹ä¸ªå›¾ï¼Œæ›´ç›´è§‚ç‚¹ï¼š

![](https://files.mdnice.com/user/71186/2c7e04b1-6a97-4e0a-af63-07f70e788a35.png)

> **æ³¨æ„**ï¼šä¸Šé¢è¯´çš„æ˜¯å®ç° TCP æœåŠ¡å™¨çš„æ­¥éª¤ï¼Œå¦‚æœæ˜¯å®ç° UDP æœåŠ¡å™¨ï¼Œåˆ™ä¸éœ€è¦å»ºç«‹è¿æ¥å°±å¯ä»¥äº’å‘æ•°æ®ã€‚


### ä¸‰ã€ç®€å•ä»£ç ç¤ºä¾‹

ä¸æé‚£äº›å¤æ‚çš„èŠ±é‡Œèƒ¡å“¨ï¼Œæˆ‘ä»¬ç”¨ç®€å•çš„ä»£ç ç¤ºä¾‹çœ‹çœ‹æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ€ä¹ˆå†™ã€‚ä»¥ä¸‹æ˜¯åŸºäº Linux C å®ç°çš„ä¸€ä¸ªæç®€çš„ socket é€šä¿¡ä¾‹å­ã€‚

**1. æœåŠ¡ç«¯ä»£ç æµç¨‹ï¼š**

```c++
// åˆ›å»º socket
server_fd = socket(AF_INET, SOCK_STREAM, 0);

// è®¾ç½®å¥—æ¥å­—åœ°å€
struct sockaddr_in server_addr;
server_addr.sin_family = AF_INET;  // ä»£è¡¨ IPV4
server_addr.sin_port = htons(12345); 
server_addr.sin_addr.s_addr = INADDR_ANY; 

// ç»‘å®šåœ°å€å’Œç«¯å£
bind(server_fd, (struct sockaddr *)&server_addr, sizeof(server_addr));

// ç›‘å¬è¿æ¥
listen(server_fd, 5);

// æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥
client_fd = accept(server_fd, (struct sockaddr *)&client_addr, &client_addr_len);

// æ¥æ”¶å’Œå‘é€æ•°æ®
read(client_fd, buffer, sizeof(buffer));
write(client_fd, message, strlen(message));

// å…³é—­è¿æ¥
close(client_fd);
close(server_fd);
```

**2. å®¢æˆ·ç«¯ä»£ç æµç¨‹ï¼š**

```c++
// åˆ›å»º socket
client_fd = socket(AF_INET, SOCK_STREAM, 0);

// è®¾ç½®æœåŠ¡å™¨åœ°å€
server_addr.sin_family = AF_INET;  // ä»£è¡¨ IPV4
server_addr.sin_port = htons(12345); // 12345 ä»£è¡¨æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„ç«¯å£
server_addr.sin_addr.s_addr = inet_addr("192.168.1.1"); // 192.168.1.1 æ˜¯æœåŠ¡å™¨çš„åœ°å€

// è¿æ¥æœåŠ¡å™¨
connect(client_fd, (struct sockaddr *)&server_addr, sizeof(server_addr));

// å‘é€å’Œæ¥æ”¶æ•°æ®
write(client_fd, message, strlen(message));
read(client_fd, buffer, sizeof(buffer));

// å…³é—­è¿æ¥
close(client_fd);
```


### å››ã€socket ç¼–ç¨‹çš„ä¸€äº›ç»†èŠ‚

1. **TCP vs UDP**ï¼š
+ TCPå°±åƒæ‰“ç”µè¯ï¼Œä½ è¦å…ˆæ‹¨å·ã€æ¥é€šï¼Œç„¶åæ‰èƒ½èŠï¼ˆæœ‰è¿æ¥çš„ï¼Œå¯é ï¼‰ã€‚
+ UDPå°±åƒå¯„å¿«é€’ï¼Œç›´æ¥æŠŠåŒ…è£¹ä¸¢å‡ºå»ï¼Œä¸ç®¡å¯¹æ–¹æœ‰æ²¡æœ‰æ”¶åˆ°ï¼ˆæ— è¿æ¥ï¼Œä¸å¯é ï¼‰ã€‚
2. **Socket ç±»å‹å’Œåè®®å®¶æ—**ï¼š
+ æƒ³è±¡ socket ç±»å‹å°±åƒä¸åŒçš„é€šè®¯å·¥å…·ï¼Œ`SOCK_STREAM` æ˜¯ç±»ä¼¼äºç”µè¯ï¼Œéœ€è¦å»ºç«‹è¿æ¥ï¼ˆTCPï¼‰ï¼Œè€Œ `SOCK_DGRAM` æ›´åƒæ˜¯å¹¿æ’­ï¼ˆUDPï¼‰ï¼Œæ— éœ€è¿æ¥ï¼Œç›´æ¥å‘é€ã€‚
+ åè®®å®¶æ—æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ `AF_INET`ï¼ˆIPv4ï¼‰å’Œ `AF_INET6`ï¼ˆIPv6ï¼‰ï¼Œä½ å¯ä»¥ç†è§£ä¸ºç”¨ä¸åŒçš„â€œå›½å®¶åŒºå·â€æ¥æ‰“ç”µè¯ã€‚
3. **ç«¯å£å·é€‰æ‹©ï¼šç³»ç»Ÿä¸“ç”¨çš„VIPé€šé“**
+ ç«¯å£å·æœ‰ `0-65535` ä¹‹åˆ†ã€‚`0-1023` æ˜¯ç»™ç³»ç»Ÿçš„â€œVIPé€šé“â€ï¼Œæ¯”å¦‚ HTTP çš„ 80 ç«¯å£ï¼ŒSSH çš„ 22 ç«¯å£ï¼Œä¸€èˆ¬äººç”¨ä¸äº†ã€‚æˆ‘ä»¬æ™®é€šå¼€å‘è€…ç”¨ `1024` ä»¥ä¸Šçš„â€œæ™®é€šé€šé“â€ï¼Œé€‰ä¸€ä¸ªä¸å†²çªçš„å°±å¥½ã€‚
4. **é˜»å¡ä¸éé˜»å¡**ï¼š
+ ä»£ç ä¸­çš„ `accept()` æˆ– `recv()` é»˜è®¤æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯ç­‰ä¸åˆ°æ•°æ®ä¸ä¼šç»§ç»­å¾€ä¸‹èµ°ã€‚å¦‚æœä½ ä¸æƒ³è®©ç¨‹åºå¡ä½ï¼Œå¯ä»¥æŠŠ socket è®¾ä¸ºéé˜»å¡æ¨¡å¼ã€‚
+ è®¾ç½®éé˜»å¡æ¨¡å¼ï¼š`fcntl(socket_fd, F_SETFL, O_NONBLOCK); `
5. **è¶…æ—¶è®¾ç½®**ï¼š
+ ä½ çŸ¥é“ç­‰å¾…ä¸€ä¸ªæ²¡æ¥çš„ç”µè¯æ˜¯ä»€ä¹ˆæ„Ÿè§‰å—ï¼Ÿsocket ä¹Ÿå¯èƒ½å› ä¸ºå¯¹æ–¹ä¸å“åº”è€Œâ€œå¡ä½â€ã€‚ä½ å¯ä»¥ä½¿ç”¨ `setsockopt()` ä¸º socket è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¾‹å¦‚åªç­‰å¯¹æ–¹ 5 ç§’ï¼Œè¶…æ—¶äº†å°±ä¸å†ç­‰å¾…ã€‚

```c

struct timeval timeout;
timeout.tv_sec = 5;
timeout.tv_usec = 0;
setsockopt(socket_fd, SOL_SOCKET, SO_RCVTIMEO, (const char*)&timeout, sizeof timeout);
```

6. **åœ°å€å¤ç”¨**ï¼š
+ å‡è®¾ä½ æ¯æ¬¡æ‰“ç”µè¯å‰éƒ½å¾—æ¢æ–°å·ç ï¼Œé‚£å¾—å¤šéº»çƒ¦ï¼Ÿé€šè¿‡è®¾ç½® `SO_REUSEADDR`ï¼Œä½ å¯ä»¥åœ¨æœåŠ¡å™¨é‡å¯åç»§ç»­ä½¿ç”¨ç›¸åŒçš„ç«¯å£ï¼Œè€Œä¸å¿…ç­‰å¾…æ—§è¿æ¥é‡Šæ”¾èµ„æºã€‚

```c

int opt = 1;
setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));
```

####  äº”ã€socket ç¼–ç¨‹å¥—æ¥å­—åœ°å€ç»“æ„å’Œå¸¸ç”¨æ¥å£

åœ¨è¿›è¡Œ socket ç¼–ç¨‹æ—¶ï¼Œæœ‰ä¸€äº›å¸¸ç”¨çš„ API å’Œå·¥å…·æ˜¯ä½ å¿…é¡»ç†Ÿç»ƒæŒæ¡çš„ã€‚è¿™é‡Œæˆ‘ä»¬æ¥é€ä¸ªäº†è§£è¿™äº›å…³é”®å·¥å…·ï¼Œå¸®åŠ©ä½ åœ¨ç¼–å†™ç½‘ç»œç¨‹åºæ—¶æ¸¸åˆƒæœ‰ä½™ã€‚

#### 5.1 å¥—æ¥å­—åœ°å€ç»“æ„åŠåœ°å€è½¬æ¢ API

å…ˆæ¥çœ‹çœ‹å¸¸ç”¨çš„å¥—æ¥å­—åœ°å€ç»“æ„ï¼š

```c++

struct sockaddr {
   sa_family_t     sa_family;      /* Address family */
   char            sa_data[];      /* Socket address */
};

// å¥—æ¥å­—åœ°å€ç»“æ„ï¼ˆé€‚ç”¨äºIPv4ç½‘ç»œé€šä¿¡çš„åœ°å€ç»“æ„ï¼‰
struct sockaddr_in 
{
    sa_family_t    sin_family; # address family: AF_INET 
    in_port_t      sin_port;   # port in network byte order 
    struct in_addr sin_addr;   # ip address 
};

struct in_addr
{
     uint32_t       s_addr;    # address in network byte order 
};
```

+ `sockaddr` æ˜¯ä¸€ä¸ªé€šç”¨çš„å¥—æ¥å­—åœ°å€ç»“æ„ï¼Œå®ƒé€šå¸¸ä¸ç‰¹å®šçš„åœ°å€æ—ç»“æ„ï¼ˆå¦‚ `sockaddr_in`ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚å¤§å¤šæ•°å¥—æ¥å­—å‡½æ•°ï¼Œå¦‚ `bind()`ã€`connect()` å’Œ `accept()`ï¼Œéœ€è¦ä½¿ç”¨æŒ‡å‘ `sockaddr` ç»“æ„çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ã€‚
+ `sockaddr_in` æ˜¯é€‚ç”¨äº IPv4 ç½‘ç»œé€šä¿¡çš„åœ°å€ç»“æ„ï¼Œä¸“é—¨ç”¨äºå­˜å‚¨ IP åœ°å€å’Œç«¯å£ä¿¡æ¯ã€‚

**ä»£ç ç¤ºä¾‹**ï¼šä½¿ç”¨ `sockaddr` å’Œ `sockaddr_in` è¿›è¡ŒæœåŠ¡å™¨åœ°å€çš„ç»‘å®šã€‚

```c++

struct sockaddr_in server_addr;
server_addr.sin_family = AF_INET;
server_addr.sin_port = htons(12345); // ç«¯å£å·è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº
server_addr.sin_addr.s_addr = INADDR_ANY; // ç»‘å®šåˆ°æœ¬åœ°æ‰€æœ‰å¯ç”¨åœ°å€

// ä½¿ç”¨ sockaddr è¿›è¡Œç»‘å®š
if (bind(server_fd, (struct sockaddr *)&server_addr, sizeof(server_addr)) == -1) {
    perror("bind failed");
    close(server_fd);
    exit(EXIT_FAILURE);
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºå¹¶åˆå§‹åŒ–äº† `sockaddr_in` ç»“æ„ä½“ï¼Œç„¶åå°†å…¶å¼ºåˆ¶è½¬æ¢ä¸ºé€šç”¨çš„ `sockaddr` ç»“æ„æŒ‡é’ˆä¼ é€’ç»™ `bind()` å‡½æ•°ï¼Œè¿™æ ·å°±å®Œæˆäº†åœ°å€ç»‘å®šã€‚

#### 5.2 å­—èŠ‚åºè½¬æ¢ API

åœ¨ socket ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªå«åšå­—èŠ‚åºçš„é—®é¢˜ã€‚ä¸»æœºå’Œç½‘ç»œä¹‹é—´çš„å­—èŠ‚é¡ºåºå¯èƒ½ä¸åŒï¼Œç½‘ç»œæ•°æ®é‡‡ç”¨çš„æ˜¯â€œå¤§ç«¯å­—èŠ‚åºâ€ï¼Œè€Œæœºå™¨æœ‰å¯èƒ½é‡‡ç”¨â€œå°ç«¯å­—èŠ‚åºâ€ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯â€œå¤§ç«¯å­—èŠ‚åºâ€ã€‚ä¸ºäº†ä¿è¯æ•°æ®åœ¨ç½‘ç»œå’Œä¸»æœºè®¾å¤‡ä¹‹é—´ä¼ è¾“æ—¶æ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘é€æ•°æ®å‰åšä¸€äº›â€œå­—èŠ‚åºè½¬æ¢â€ã€‚

**ä¸»è§’ä»¬ç™»åœºï¼**

- `htons() å’Œ htonl()`ï¼šè¿™ä¸¤ä¸ªå‡½æ•°ç”¨äºå°†æ•°æ®ä»ä¸»æœºå­—èŠ‚åºï¼ˆé€šå¸¸æ˜¯å°ç«¯å­—èŠ‚åºï¼‰è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼ˆå¤§ç«¯å­—èŠ‚åºï¼‰ã€‚htons() å¤„ç† 16 ä½æ•°æ®ï¼ˆå¦‚ç«¯å£å·ï¼‰ï¼Œhtonl() å¤„ç† 32 ä½æ•°æ®ï¼ˆå¦‚ IP åœ°å€ï¼‰ã€‚

- `ntohs() å’Œ ntohl()`ï¼šå®ƒä»¬çš„åå­—åˆšå¥½æ˜¯åè¿‡æ¥çš„ï¼Œä½œç”¨ä¹Ÿç›¸åï¼Œæ˜¯æŠŠç½‘ç»œå­—èŠ‚åºè½¬æ¢å›ä¸»æœºå­—èŠ‚åºï¼Œç¡®ä¿æ¥æ”¶åˆ°çš„æ•°æ®èƒ½å¤Ÿæ­£ç¡®ç†è§£ã€‚ntohs() å¤„ç† 16 ä½æ•°æ®(ç«¯å£)ï¼Œntohl(IP åœ°å€) å¤„ç† 32 ä½æ•°æ®ã€‚

**è®°å¿†å°æŠ€å·§**ï¼š
- htonsï¼šhost to network shortï¼ˆä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œå¤„ç†çŸ­æ•´å‹æ•°æ®ï¼Œ16 ä½ï¼‰ã€‚
- htonlï¼šhost to network longï¼ˆä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œå¤„ç†é•¿æ•´å‹æ•°æ®ï¼Œ32 ä½ï¼‰ã€‚
- ntohsï¼šnetwork to host shortï¼ˆç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åºï¼Œå¤„ç†çŸ­æ•´å‹æ•°æ®ï¼Œ16 ä½ï¼‰ã€‚
- ntohlï¼šnetwork to host longï¼ˆç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åºï¼Œå¤„ç†é•¿æ•´å‹æ•°æ®ï¼Œ32 ä½ï¼‰ã€‚

> å°æç¤ºï¼šshort å’Œ long ç”¨äºåŒºåˆ† 16 ä½ å’Œ 32 ä½ æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©ä½ è®°ä½å“ªä¸ªå‡½æ•°å¤„ç†å“ªç§æ•°æ®ç±»å‹ã€‚

è¯´åˆ°è¿™é‡Œå¯èƒ½æœ‰ç‚¹ç»•ï¼Œå’±ä»¬çœ‹çœ‹ä»£ç å°±ç®€å•æ˜äº†å•¦ã€‚

æ¥çœ‹çœ‹åœ¨ C ä¸­å¦‚ä½•ä½¿ç”¨è¿™äº› APIï¼š
```c
#include <stdio.h>
#include <arpa/inet.h>

int main() {
    // ä¸»æœºå­—èŠ‚åºçš„ç«¯å£å·
    uint16_t port = 12345;
    uint16_t net_port = htons(port); // å°†ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œnet_port å°±å¯ä»¥ç›´æ¥åœ¨ç½‘ç»œä¸Šä¼ è¾“
    printf("ç½‘ç»œå­—èŠ‚åºçš„ç«¯å£å·: %d\n", net_port);

    // ä¸»æœºå­—èŠ‚åºçš„ IP åœ°å€
    uint32_t ip = 0x7F000001; // 127.0.0.1 çš„ 16 è¿›åˆ¶
    uint32_t net_ip = htonl(ip); // å°†ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº, è¿™æ · net_ip å°±å¯ä»¥åœ¨ç½‘ç»œä¸Šä¼ è¾“äº†
    printf("ç½‘ç»œå­—èŠ‚åºçš„ IP åœ°å€: %x\n", net_ip);

    // æ¥æ”¶æ•°æ®æ—¶è½¬æ¢å›ä¸»æœºå­—èŠ‚åº
    uint16_t received_port = ntohs(net_port); // å°†ç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åº
    printf("ä¸»æœºå­—èŠ‚åºçš„ç«¯å£å·: %d\n", received_port);

    return 0;
}
```
ä»£ç è§£è¯´:

- è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•ç”¨ htons() å’Œ htonl() æ¥æŠŠä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸ªç«¯å£å· 12345ï¼Œç›´æ¥æ‹¿å»ç½‘ç»œä¸Šä¼ çš„è¯å¯èƒ½ä¼šå˜æˆä¹±ä¸ƒå…«ç³Ÿçš„æ•°å­—ï¼Œå› ä¸ºå„ä¸ªæœºå™¨å¯¹å­—èŠ‚é¡ºåºçš„ç†è§£ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¾—å…ˆç”¨ htons() æŠŠå®ƒå˜æˆå¤§å®¶éƒ½èƒ½ç†è§£çš„æ ¼å¼ã€‚

- ç±»ä¼¼åœ°ï¼Œå¯¹äº IP åœ°å€ 127.0.0.1ï¼ˆ0x7F000001ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ htonl() æ¥ç¡®ä¿åœ¨ç½‘ç»œä¸Šä¼ è¾“æ—¶ä¸ä¼šå› ä¸ºå­—èŠ‚é¡ºåºä¸åŒè€Œå‡ºé”™ã€‚

- å½“æ•°æ®ä»ç½‘ç»œä¼ å›æ¥æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ ntohs() å’Œ ntohl() æŠŠå®ƒä»¬è½¬æ¢å›ä¸»æœºçš„å­—èŠ‚åºï¼Œå°±åƒæˆ‘ä»¬ç”¨ ntohs() æŠŠæ¥æ”¶åˆ°çš„ç«¯å£å·è½¬å›å»ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æ­£ç¡®åœ°ç†è§£è¿™äº›æ•°æ®ã€‚

#### 5.3 åœ°å€è½¬æ¢ API

é™¤äº†å­—èŠ‚åºè½¬æ¢ï¼Œç½‘ç»œç¼–ç¨‹ä¸­è¿˜æœ‰ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ IP åœ°å€çš„è¡¨ç¤ºæ–¹å¼ã€‚æˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨å­—ç¬¦ä¸²å½¢å¼ï¼ˆæ¯”å¦‚ "192.168.1.1"ï¼‰å’ŒäºŒè¿›åˆ¶å½¢å¼ä¹‹é—´æ¥å›è½¬æ¢ã€‚è¿™æ—¶å€™ï¼Œå°±æœ‰ä¸¤ä½â€œå¥½å¸®æ‰‹â€å¯ä»¥ç”¨ï¼š

- inet_pton()ï¼šinet_pton() æ˜¯æŠŠäººç±»çœ‹å¾—æ‡‚çš„ IP åœ°å€å­—ç¬¦ä¸²(å¦‚ "192.168.1.1")ï¼Œç¿»è¯‘æˆè®¡ç®—æœºèƒ½ç†è§£çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œç”¨äºç½‘ç»œé€šä¿¡ã€‚

- inet_ntop()ï¼šè¿™ä¸ªå‡½æ•°åˆ™æ˜¯åšåå‘æ“ä½œï¼ŒæŠŠäºŒè¿›åˆ¶æ ¼å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹ã€‚

æ¥çœ‹çœ‹åœ°å€è½¬æ¢ä»£ç æ€ä¹ˆå†™ï¼š

```c
#include <iostream>
#include <arpa/inet.h>

int main() {
    struct sockaddr_in server_addr;
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(12345); // å°†ç«¯å£å·è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº

    // å°†å­—ç¬¦ä¸²å½¢å¼çš„ IP åœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼
    inet_pton(AF_INET, "192.168.1.1", &server_addr.sin_addr);
    printf("äºŒè¿›åˆ¶æ ¼å¼çš„ IP åœ°å€å·²è®¾ç½®\n");

    // å°†äºŒè¿›åˆ¶æ ¼å¼çš„ IP åœ°å€è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼
    char ip_str[INET_ADDRSTRLEN];
    inet_ntop(AF_INET, &server_addr.sin_addr, ip_str, INET_ADDRSTRLEN);
    printf("IP åœ°å€: %s\n", ip_str); // è¾“å‡º: 192.168.1.1

    return 0;
}
```
ä»£ç è§£è¯´

- åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† inet_pton() æ¥æŠŠå­—ç¬¦ä¸²å½¢å¼çš„ IP åœ°å€ "192.168.1.1" è½¬æ¢ä¸º sockaddr_in ç»“æ„ä½“ä¸­çš„äºŒè¿›åˆ¶æ ¼å¼ã€‚è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œè®¡ç®—æœºæ›´å–œæ¬¢å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œè€Œä¸æ˜¯äººç±»å¯è¯»çš„å­—ç¬¦ä¸²ã€‚
- ç„¶åï¼Œæˆ‘ä»¬ç”¨ inet_ntop() æŠŠè¿™ä¸ªäºŒè¿›åˆ¶æ ¼å¼çš„ IP åœ°å€è½¬æ¢å›å­—ç¬¦ä¸²å½¢å¼ï¼Œæ–¹ä¾¿è¾“å‡ºå’ŒæŸ¥çœ‹ã€‚è¿™ä¸¤ä¸ªå‡½æ•°å°±åƒ IP åœ°å€çš„â€œç¿»è¯‘å®˜â€ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨ä¸åŒçš„è¡¨ç¤ºæ–¹å¼ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚

å¦å¤–ï¼Œinet_addr() å’Œ inet_aton() ä¹Ÿç”¨äºå°†å­—ç¬¦ä¸²å½¢å¼çš„ IPv4 åœ°å€è½¬æ¢ä¸ºæ•°å€¼æ ¼å¼ï¼Œä¸è¿‡å®ƒä»¬è¾ƒæ—§ï¼ŒåŠŸèƒ½è¾ƒå°‘ï¼Œä¸”åªæ”¯æŒ IPv4ã€‚inet_pton() å’Œ inet_ntop() æ˜¯ç°ä»£ç½‘ç»œç¼–ç¨‹ä¸­æ¨èä½¿ç”¨çš„å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬æ”¯æŒ IPv4 å’Œ IPv6ï¼Œå¹¶ä¸”æ›´å®‰å…¨ã€‚

**å°ç»“**ï¼šé€šè¿‡è¿™äº› APIï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åºä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œä¹Ÿå¯ä»¥åœ¨å­—ç¬¦ä¸²å’ŒäºŒè¿›åˆ¶çš„ IP åœ°å€ä¹‹é—´åˆ‡æ¢ã€‚è¿™äº›å‡½æ•°å°±åƒæ˜¯æ•°æ®çš„â€œç¿»è¯‘å®˜â€ï¼Œè®©æˆ‘ä»¬åœ¨ç½‘ç»œç¼–ç¨‹ä¸­å¤„ç†æ•°æ®æ—¶æ›´åŠ æ–¹ä¾¿ã€å®‰å…¨ï¼Œä¹Ÿæ›´ä¸å®¹æ˜“å‡ºé”™ã€‚

### å…­ã€å®Œæ•´ socket æœåŠ¡å™¨å®¢æˆ·ç«¯ç¤ºä¾‹(åŸºäº Linux C å®ç°çš„å•è¿›ç¨‹ç‰ˆæœ¬)

ä¸‹é¢æä¾›ä¸€ä¸ªå®Œæ•´çš„ socket æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºï¼ŒåŸºäº Linux C å®ç°ã€‚

**1. å®Œæ•´çš„æœåŠ¡å™¨ç¨‹åºï¼š**

```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <arpa/inet.h>

#define PORT 12345

int main() {
    int server_fd, client_fd;
    struct sockaddr_in server_addr, client_addr;
    socklen_t client_addr_len = sizeof(client_addr);
    char buffer[1024] = {0};

    // åˆ›å»º socket
    server_fd = socket(AF_INET, SOCK_STREAM, 0);
    if (server_fd == -1) {
        perror("socket failed");
        exit(EXIT_FAILURE);
    }

    // ç»‘å®šåœ°å€å’Œç«¯å£
    server_addr.sin_family = AF_INET;
    server_addr.sin_addr.s_addr = INADDR_ANY;
    server_addr.sin_port = htons(PORT);

    if (bind(server_fd, (struct sockaddr *)&server_addr, sizeof(server_addr)) == -1) {
        perror("bind failed");
        close(server_fd);
        exit(EXIT_FAILURE);
    }

    // ç›‘å¬è¿æ¥
    if (listen(server_fd, 5) == -1) {
        perror("listen failed");
        close(server_fd);
        exit(EXIT_FAILURE);
    }

    printf("æœåŠ¡å™¨æ­£åœ¨ç­‰å¾…è¿æ¥...
");

    while (1) {
        // æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥
        client_fd = accept(server_fd, (struct sockaddr *)&client_addr, &client_addr_len);
        if (client_fd == -1) {
            perror("accept failed");
            continue;
        }

        // æ¥æ”¶æ•°æ®
        read(client_fd, buffer, sizeof(buffer));
        printf("æ”¶åˆ°æ•°æ®: %s
", buffer);

        // å‘é€æ•°æ®
        char *message = "Hello from server!";
        write(client_fd, message, strlen(message));

        // å…³é—­å®¢æˆ·ç«¯è¿æ¥
        close(client_fd);
    }

    // å…³é—­æœåŠ¡å™¨è¿æ¥
    close(server_fd);

    return 0;
}
```

**2. å®Œæ•´çš„å®¢æˆ·ç«¯ç¨‹åºï¼š**

```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <arpa/inet.h>

#define PORT 12345

int main() {
    int client_fd;
    struct sockaddr_in server_addr;
    char buffer[1024] = {0};

    // åˆ›å»º socket
    client_fd = socket(AF_INET, SOCK_STREAM, 0);
    if (client_fd == -1) {
        perror("socket failed");
        exit(EXIT_FAILURE);
    }

    // è®¾ç½®æœåŠ¡å™¨åœ°å€
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(PORT);
    server_addr.sin_addr.s_addr = inet_addr("192.168.1.1"); // æœåŠ¡å™¨åœ°å€

    // è¿æ¥æœåŠ¡å™¨
    if (connect(client_fd, (struct sockaddr *)&server_addr, sizeof(server_addr)) == -1) {
        perror("connect failed");
        close(client_fd);
        exit(EXIT_FAILURE);
    }

    // å¾ªç¯å‘é€å’Œæ¥æ”¶æ•°æ®
    while (1) {
        char message[1024];
        printf("è¯·è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯ (è¾“å…¥"exit"é€€å‡º): ");
        fgets(message, sizeof(message), stdin);
        message[strcspn(message, "\n")] = 0; // ç§»é™¤æ¢è¡Œç¬¦

        // åˆ¤æ–­æ˜¯å¦é€€å‡º
        if (strcmp(message, "exit") == 0) {
            break;
        }

        // å‘é€æ•°æ®
        write(client_fd, message, strlen(message));

        // æ¥æ”¶æ•°æ®
        memset(buffer, 0, sizeof(buffer));
        read(client_fd, buffer, sizeof(buffer));
        printf("æ”¶åˆ°æ•°æ®: %s\n", buffer);
    }

    // å…³é—­è¿æ¥
    close(client_fd);

    return 0;
}

```

ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œä¸Šé¢çš„ socket æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå•è¿›ç¨‹ç‰ˆæœ¬ï¼Œæ— æ³•åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œåªèƒ½ä¸€ä¸ªä¸ªåœ°å¤„ç†ï¼Œæ•ˆç‡ä¸é«˜ã€‚è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†ä¸€æ—¦æœ‰å¾ˆå¤šå®¢æˆ·ç«¯åŒæ—¶è¿æ¥ï¼ŒæœåŠ¡å™¨å°±å¿™ä¸è¿‡æ¥äº†ã€‚

### ä¸ƒã€ç»“è¯­ï¼š

Linux socket ç¼–ç¨‹å…¶å®ä¸å¤æ‚ï¼Œåªè¦æŒæ¡äº†åŸºæœ¬æ¦‚å¿µå’Œæµç¨‹ï¼Œå†™å‡ºä¸€ä¸ªèƒ½è¿è¡Œçš„ socket ç¨‹åºå…¶å®å¾ˆå®¹æ˜“ã€‚ä¸è¿‡ï¼Œå•è¿›ç¨‹å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯å°±åƒæ’é˜Ÿä¹°ç¥¨ï¼Œä¸€ä¸ªäººä¸€ä¸ªäººæ¥ï¼Œç‰¹åˆ«æ…¢ã€‚è¿™æ—¶å€™ï¼Œå¤šè¿›ç¨‹æ¨¡å‹å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œè®©æœåŠ¡å™¨å¯ä»¥åŒæ—¶å¤„ç†æ›´å¤šç”¨æˆ·ï¼Œä¸å†è®©å¤§å®¶ç­‰å¾—ç€æ€¥ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å°±èŠèŠæ€ä¹ˆç”¨å¤šè¿›ç¨‹æ¨¡å‹æ¥æå‡æœåŠ¡å™¨èƒ½åŠ›ï¼Œè®©å®ƒå˜å¾—æ›´å¿«æ›´å¼ºï¼

## æœ€åï¼š

å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç»™æˆ‘ç‚¹ä¸ªåœ¨çœ‹å’Œèµ ğŸ‘ï¼Œå¹¶åˆ†äº«ç»™æœ‰éœ€è¦çš„å°ä¼™ä¼´å§ï¼ä¹Ÿæ¬¢è¿å¤§å®¶æ¥å…³æ³¨æˆ‘å…¬ä¼—å· ã€Œè·Ÿç€å°åº·å­¦ç¼–ç¨‹ã€ï¼Œå¾®ä¿¡æœç´¢ **è·Ÿç€å°åº·å­¦ç¼–ç¨‹** å³å¯å…³æ³¨ï¼


## å…³æ³¨æˆ‘èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ

- è¿™é‡Œåˆ†äº« Linux Cã€C++ã€Go å¼€å‘ã€è®¡ç®—æœºåŸºç¡€çŸ¥è¯† å’Œ ç¼–ç¨‹é¢è¯•å¹²è´§ç­‰ï¼Œå†…å®¹æ·±å…¥æµ…å‡ºï¼Œè®©æŠ€æœ¯å­¦ä¹ å˜å¾—è½»æ¾æœ‰è¶£ã€‚

- æ— è®ºæ‚¨æ˜¯å¤‡æˆ˜é¢è¯•ï¼Œè¿˜æ˜¯æƒ³æå‡ç¼–ç¨‹æŠ€èƒ½ï¼Œè¿™é‡Œéƒ½è‡´åŠ›äºæä¾›å®ç”¨ã€æœ‰è¶£ã€æœ‰æ·±åº¦çš„æŠ€æœ¯åˆ†äº«ã€‚å¿«æ¥å…³æ³¨ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æˆé•¿ï¼

## æ€ä¹ˆå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Ÿ

**éå¸¸ç®€å•ï¼æ‰«æä¸‹æ–¹äºŒç»´ç å³å¯ä¸€é”®å…³æ³¨ã€‚**

![](https://files.mdnice.com/user/71186/0dde803d-d52f-4ed8-b74b-b7f3da5817b9.png)

å¦å¤–æˆ‘è¿˜å»ºäº†ä¸ª**æŠ€æœ¯äº¤æµç¾¤**ï¼Œé‡Œé¢éƒ½æ˜¯çœŸæ­£åœ¨å†™ä»£ç çš„åŒè¡Œï¼Œä¸èŠè™šçš„ï¼ŒåªèŠæŠ€æœ¯ã€‚æœ‰é—®é¢˜å¤§å®¶ä¸€èµ·è®¨è®ºï¼Œæ¯”ä¸€ä¸ªäººé—·å¤´å­¦æ•ˆç‡é«˜å¤šäº†ã€‚
  
![](https://files.mdnice.com/user/48364/4ebc72e9-e4bb-447a-9a92-8367a178df6d.png)

è®°ä½ï¼ŒæŠ€æœ¯è¿™æ¡è·¯ï¼Œä¸€ä¸ªäººèµ°å®¹æ˜“è¿·è·¯ï¼Œä¸€ç¾¤äººèµ°æ‰èƒ½èµ°å¾—æ›´è¿œã€‚

