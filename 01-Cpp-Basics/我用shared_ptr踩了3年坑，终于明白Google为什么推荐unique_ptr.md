å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°åº·ã€‚

æœ€è¿‘åœ¨æŠ€æœ¯ç¾¤é‡Œçœ‹åˆ°ä¸€ä¸ªæœ‰è¶£çš„è®¨è®ºï¼Œä¸€ä¸ªå°ä¼™ä¼´é—®ï¼š"ä¸ºä»€ä¹ˆGoogleçš„ä»£ç è§„èŒƒæ€»æ˜¯æ¨èç”¨unique_ptrï¼Œå¯¹shared_ptrå´å¾ˆè°¨æ…ï¼Ÿæ˜¯ä¸æ˜¯shared_ptræœ‰ä»€ä¹ˆå‘ï¼Ÿ"

è¿™ä¸ªé—®é¢˜ç¬é—´ç‚¸å‡ºäº†ä¸€ç¾¤æŠ€æœ¯å¤§ä½¬ï¼Œæœ‰äººè¯´shared_ptræ€§èƒ½å·®ï¼Œæœ‰äººè¯´å®¹æ˜“å†…å­˜æ³„æ¼ï¼Œè¿˜æœ‰äººè¯´è®¾è®¡æ€è·¯å°±ä¸å¯¹...

è¯´å®è¯ï¼Œæˆ‘åˆšå¼€å§‹å­¦C++çš„æ—¶å€™ä¹Ÿå¾ˆå›°æƒ‘ã€‚æ˜æ˜shared_ptrçœ‹èµ·æ¥æ›´"æ™ºèƒ½"å•Šï¼Œå¯ä»¥è‡ªåŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°ï¼Œå¤šä¸ªå¯¹è±¡å¯ä»¥å…±äº«ï¼Œå¬èµ·æ¥å°±å¾ˆé«˜çº§ã€‚è€Œunique_ptrå¥½åƒå°±æ˜¯ä¸ª"ç‹¬å ç‹‚"ï¼Œä¸€ä¸ªå¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªä¸»äººï¼Œæ˜¾å¾—å¾ˆ"å°æ°”"ã€‚

ä½†æ˜¯å·¥ä½œå‡ å¹´åï¼Œæˆ‘ç»ˆäºæ˜ç™½äº†å…¶ä¸­çš„é—¨é“ã€‚ä»Šå¤©å°±æ¥ç»™å¤§å®¶æ·±åº¦å‰–æä¸€ä¸‹è¿™ä¸¤ä¸ª"æ™ºèƒ½æŒ‡é’ˆå…„å¼Ÿ"çš„æ©æ€¨æƒ…ä»‡ã€‚

>æƒ³ç³»ç»Ÿå­¦ä¹ æ›´å¤š C++ çŸ¥è¯†ï¼Ÿæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œ**è·Ÿç€å°åº·ç¼–ç¨‹**ã€ï¼Œæˆ‘ä¼šæŒç»­æ›´æ–° Cã€ C++ã€Linuxã€åç«¯å¼€å‘ç­‰é«˜è´¨é‡æŠ€æœ¯æ–‡ç« ã€‚ä¹Ÿå¯ä»¥åŠ æˆ‘çš„ä¸ªäººå¾®ä¿¡ï¼Œä¸€èµ·è¿›ç¾¤è®¨è®ºå­¦ä¹ ï¼
>
> 
> <table>
> <tr>
> <td align="center">
> <img src="https://github.com/xiaokangcoding/follow-xiaokang-coding/raw/main/images/qrcode-wechat-official.png" width="200">
> <br>
> <em>å…¬ä¼—å·ã€Œè·Ÿç€å­¦å°åº·ç¼–ç¨‹ã€</em>
> </td>
> <td align="center">
> <img src="https://github.com/xiaokangcoding/follow-xiaokang-coding/raw/main/images/qrcode-personal-wechat.png" width="200">
> <br>
> <em>ä¸ªäººå¾®ä¿¡ï¼ˆå¤‡æ³¨ï¼šåŠ ç¾¤ï¼‰</em>
> </td>
> </tr>
> </table>

## å…ˆè¯´è¯´è¿™ä¸¤å…„å¼Ÿçš„"å‡ºèº«"

### unique_ptrï¼šç‹¬å å‹çš„"ä¸“ä¸€ç”·å‹"
unique_ptrå°±åƒé‚£ç§ä¸“ä¸€çš„ç”·æœ‹å‹ï¼Œä¸€æ—¦è®¤å®šäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ç‹¬å æ‰€æœ‰æƒï¼Œç»ä¸ä¸å…¶ä»–äººåˆ†äº«ã€‚

```cpp
std::unique_ptr<int> ptr1(new int(42));
// std::unique_ptr<int> ptr2 = ptr1;  // ç¼–è¯‘é”™è¯¯ï¼ä¸èƒ½å¤åˆ¶
std::unique_ptr<int> ptr2 = std::move(ptr1);  // åªèƒ½è½¬ç§»æ‰€æœ‰æƒ
// ç°åœ¨ptr1ä¸ºç©ºï¼Œptr2æ‹¥æœ‰å¯¹è±¡
```

### shared_ptrï¼šå…±äº«å‹çš„"ä¸­å¤®ç©ºè°ƒ"
shared_ptråˆ™åƒä¸­å¤®ç©ºè°ƒï¼Œå¯ä»¥åŒæ—¶æœåŠ¡å¤šä¸ª"ç”¨æˆ·"ï¼Œå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ã€‚

```cpp
std::shared_ptr<int> ptr1(new int(42));
std::shared_ptr<int> ptr2 = ptr1;  // å¯ä»¥å¤åˆ¶ï¼Œå¼•ç”¨è®¡æ•°å˜ä¸º2
std::shared_ptr<int> ptr3 = ptr1;  // å¼•ç”¨è®¡æ•°å˜ä¸º3
// å½“æ‰€æœ‰shared_ptréƒ½é”€æ¯åï¼Œå¯¹è±¡æ‰ä¼šè¢«é‡Šæ”¾
```

## ä¸ºä»€ä¹ˆGoogleåçˆ±unique_ptrï¼Ÿ
### 1. æ€§èƒ½å·®è·ï¼šä¸æ˜¯ä¸€ä¸ªé‡çº§çš„
æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ€§èƒ½å¯¹æ¯”ï¼Œæ•°æ®ä¼šè¯´è¯ï¼š

```cpp
// æ€§èƒ½æµ‹è¯•ä»£ç 
#include <chrono>
#include <memory>

// unique_ptråˆ›å»ºå’Œé”€æ¯
auto start = std::chrono::high_resolution_clock::now();
for (int i = 0; i < 1000000; ++i) {
    auto ptr = std::make_unique<int>(i);
}  // è‡ªåŠ¨é”€æ¯
auto end = std::chrono::high_resolution_clock::now();
std::cout << "unique_ptrç”¨æ—¶: " << 
    std::chrono::duration_cast<std::chrono::microseconds>(end - start).count() 
    << "å¾®ç§’" << std::endl;

// shared_ptråˆ›å»ºå’Œé”€æ¯
start = std::chrono::high_resolution_clock::now();
for (int i = 0; i < 1000000; ++i) {
    auto ptr = std::make_shared<int>(i);
}  // è‡ªåŠ¨é”€æ¯
end = std::chrono::high_resolution_clock::now();
std::cout << "shared_ptrç”¨æ—¶: " << 
    std::chrono::duration_cast<std::chrono::microseconds>(end - start).count() 
    << "å¾®ç§’" << std::endl;
```

åœ¨æˆ‘çš„æœºå™¨ä¸Šæµ‹è¯•ç»“æœï¼š

+ unique_ptrï¼šçº¦20072å¾®ç§’
+ shared_ptrï¼šçº¦60081å¾®ç§’

**shared_ptrç«Ÿç„¶æ¯”unique_ptræ…¢äº†4å€å¤šï¼**

ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸ºshared_ptréœ€è¦ï¼š

+ ç»´æŠ¤å¼•ç”¨è®¡æ•°ï¼ˆåŸå­æ“ä½œï¼Œçº¿ç¨‹å®‰å…¨ä½†å¼€é”€å¤§ï¼‰
+ é¢å¤–çš„å†…å­˜åˆ†é…ï¼ˆæ§åˆ¶å—ï¼‰
+ å¤åˆ¶æ—¶éœ€è¦åŸå­é€’å¢
+ é”€æ¯æ—¶éœ€è¦åŸå­é€’å‡å¹¶æ£€æŸ¥æ˜¯å¦ä¸º0

### 2. å†…å­˜å¼€é”€ï¼šshared_ptræ˜¯ä¸ª"å¤§èƒƒç‹"
```cpp
std::cout << "unique_ptrå¤§å°: " << sizeof(std::unique_ptr<int>) << "å­—èŠ‚" << std::endl;
std::cout << "shared_ptrå¤§å°: " << sizeof(std::shared_ptr<int>) << "å­—èŠ‚" << std::endl;
```

ç»“æœï¼š

+ unique_ptrï¼š8å­—èŠ‚ï¼ˆå°±æ˜¯ä¸€ä¸ªæ™®é€šæŒ‡é’ˆï¼‰
+ shared_ptrï¼š16å­—èŠ‚ï¼ˆæŒ‡é’ˆ+æ§åˆ¶å—æŒ‡é’ˆï¼‰

è€Œä¸”shared_ptrè¿˜ä¼šé¢å¤–åˆ†é…ä¸€ä¸ªæ§åˆ¶å—ï¼Œå­˜å‚¨å¼•ç”¨è®¡æ•°ç­‰ä¿¡æ¯ï¼Œè‡³å°‘éœ€è¦é¢å¤–çš„16ä¸ªå­—èŠ‚ã€‚

å¦‚æœä½ çš„ç¨‹åºä¸­æœ‰å¤§é‡çš„æ™ºèƒ½æŒ‡é’ˆï¼Œè¿™ä¸ªå·®è·å°±å¾ˆæ˜æ˜¾äº†ã€‚

### 3. è®¾è®¡å“²å­¦ï¼šownershipè¦æ¸…æ™°
Googleçš„ä»£ç è§„èŒƒæœ‰ä¸€ä¸ªé‡è¦åŸåˆ™ï¼š**æ‰€æœ‰æƒè¦æ¸…æ™°**ã€‚

çœ‹è¿™ä¸ªä¾‹å­ï¼š

```cpp
// ä¸å¥½çš„è®¾è®¡ï¼šæ‰€æœ‰æƒä¸æ˜ç¡®
class DataProcessor {
    std::shared_ptr<Data> data_;
public:
    void setData(std::shared_ptr<Data> data) { data_ = data; }
};

class DataCache {
    std::shared_ptr<Data> cached_data_;
public:
    void cache(std::shared_ptr<Data> data) { cached_data_ = data; }
};

// ä½¿ç”¨æ—¶ï¼šè°æ‹¥æœ‰dataï¼Ÿè°è´Ÿè´£ç”Ÿå‘½å‘¨æœŸï¼Ÿä¸æ¸…æ¥šï¼
auto data = std::make_shared<Data>();
processor.setData(data);
cache.cache(data);
```

```cpp
// å¥½çš„è®¾è®¡ï¼šæ‰€æœ‰æƒæ¸…æ™°
class DataManager {
    std::unique_ptr<Data> data_;  // æ˜ç¡®çš„æ‹¥æœ‰è€…
public:
    Data* getData() { return data_.get(); }  // åªæä¾›è®¿é—®æƒ
    void setData(std::unique_ptr<Data> data) { 
        data_ = std::move(data); 
    }
};

// ä½¿ç”¨æ—¶ï¼šDataManageræ˜ç¡®æ‹¥æœ‰data
auto data = std::make_unique<Data>();
manager.setData(std::move(data));
```

## shared_ptrçš„"éšå½¢ç‚¸å¼¹"
### 1. å¾ªç¯å¼•ç”¨ï¼šç¨‹åºå‘˜çš„å™©æ¢¦
è¿™æ˜¯shared_ptræœ€è‘—åçš„å‘ï¼š

```cpp
class Parent;
class Child;

class Parent {
public:
    std::shared_ptr<Child> child_;
    ~Parent() { std::cout << "Parentææ„" << std::endl; }
};

class Child {
public:
    std::shared_ptr<Parent> parent_;  // å±é™©ï¼å¾ªç¯å¼•ç”¨
    ~Child() { std::cout << "Childææ„" << std::endl; }
};

{
    auto parent = std::make_shared<Parent>();
    auto child = std::make_shared<Child>();
    
    parent->child_ = child;
    child->parent_ = parent;  // å½¢æˆå¾ªç¯å¼•ç”¨
}
// ç¨‹åºç»“æŸï¼Œä½†ä½ ä¼šå‘ç°ææ„å‡½æ•°éƒ½æ²¡è¢«è°ƒç”¨ï¼
// å†…å­˜æ³„æ¼äº†ï¼
```

è¿™ç§bugç‰¹åˆ«éšè”½ï¼Œå¾ˆéš¾è°ƒè¯•ã€‚è€Œunique_pträ»è®¾è®¡ä¸Šå°±é¿å…äº†è¿™ä¸ªé—®é¢˜ã€‚

### 2. çº¿ç¨‹å®‰å…¨çš„å‡è±¡
å¾ˆå¤šäººä»¥ä¸ºshared_ptræ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…¶å®åªæ˜¯**å¼•ç”¨è®¡æ•°çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„**ï¼Œå¯¹è±¡æœ¬èº«çš„è®¿é—®å¹¶ä¸å®‰å…¨ï¼š

```cpp
std::shared_ptr<std::vector<int>> ptr = std::make_shared<std::vector<int>>();

// è¿™äº›æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼š
std::shared_ptr<std::vector<int>> ptr2 = ptr;  // æ‹·è´shared_ptr
ptr.reset();  // é‡ç½®shared_ptr
auto count = ptr.use_count();  // æŸ¥çœ‹å¼•ç”¨è®¡æ•°

// è¿™äº›æ“ä½œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼š
// çº¿ç¨‹1
ptr->push_back(1);  // ä¸å®‰å…¨ï¼ ä¿®æ”¹vectorå†…å®¹

// çº¿ç¨‹2  
ptr->push_back(2);  // ä¸å®‰å…¨ï¼

// å¼•ç”¨è®¡æ•°çš„å¢å‡æ˜¯å®‰å…¨çš„ï¼Œä½†å¯¹vectorçš„æ“ä½œä¸å®‰å…¨
```

### 3. æ€§èƒ½é™·é˜±ï¼šä¸ç»æ„çš„æ‹·è´
```cpp
// çœ‹ä¼¼æ— å®³çš„ä»£ç 
void processData(std::shared_ptr<Data> data) {  // æ³¨æ„ï¼šæŒ‰å€¼ä¼ é€’
    // å¤„ç†æ•°æ®...
}  // å‡½æ•°ç»“æŸæ—¶ï¼Œå±€éƒ¨çš„shared_ptrè¢«é”€æ¯ï¼Œå¼•ç”¨è®¡æ•°-1

// æ¯æ¬¡è°ƒç”¨éƒ½ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
auto data = std::make_shared<Data>();  // å¼•ç”¨è®¡æ•°=1
for (int i = 0; i < 1000000; ++i) {
    processData(data);  // 1. æ‹·è´shared_ptrï¼Œå¼•ç”¨è®¡æ•°+1ï¼ˆåŸå­æ“ä½œï¼‰
                        // 2. å‡½æ•°æ‰§è¡Œ
                        // 3. å‡½æ•°ç»“æŸï¼Œå¼•ç”¨è®¡æ•°-1ï¼ˆåŸå­æ“ä½œï¼‰
}
// 100ä¸‡æ¬¡åŸå­æ“ä½œçš„å¼€é”€ï¼
```

åº”è¯¥æ”¹ä¸ºï¼š

```cpp
// æ–¹æ¡ˆ1ï¼šæŒ‰å¼•ç”¨ä¼ é€’shared_ptrï¼ˆæ¨èï¼‰
void processData(const std::shared_ptr<Data>& data) {
    // å¤„ç†æ•°æ®ï¼Œæ— æ‹·è´å¼€é”€
}

// æ–¹æ¡ˆ2ï¼šä¼ é€’åŸå§‹æŒ‡é’ˆï¼ˆå¦‚æœä¸éœ€è¦å»¶é•¿ç”Ÿå‘½å‘¨æœŸï¼‰
void processData(Data* data) {
    // å¤„ç†æ•°æ®...
}

// æ–¹æ¡ˆ3ï¼šä¼ é€’å¼•ç”¨ï¼ˆå¦‚æœç¡®å®šå¯¹è±¡å­˜åœ¨ï¼‰
void processData(const Data& data) {
    // å¤„ç†æ•°æ®...
}
```

## ä»€ä¹ˆæ—¶å€™æ‰ç”¨shared_ptrï¼Ÿ
è™½ç„¶æˆ‘ä»¬ä¸€ç›´åœ¨"é»‘"shared_ptrï¼Œä½†å®ƒç¡®å®æœ‰é€‚ç”¨åœºæ™¯ï¼Œå…³é”®æ˜¯è¦**çœŸæ­£éœ€è¦å…±äº«æ‰€æœ‰æƒ**ï¼š

### 1. ç¼“å­˜ç³»ç»Ÿï¼šå¤šä¸ªæŒæœ‰è€…ï¼Œä¸ç¡®å®šè°å…ˆé‡Šæ”¾
```cpp
class ResourceCache {
    std::unordered_map<std::string, std::shared_ptr<ExpensiveResource>> cache_;
public:
    std::shared_ptr<ExpensiveResource> get(const std::string& key) {
        if (cache_.find(key) == cache_.end()) {
            cache_[key] = std::make_shared<ExpensiveResource>(key);
        }
        return cache_[key];  // è°ƒç”¨è€…å’Œç¼“å­˜éƒ½æŒæœ‰ï¼Œè°éƒ½å¯èƒ½å…ˆé‡Šæ”¾
    }
    
    void cleanup() {
        // æ¸…ç†ç¼“å­˜ï¼Œä½†å¦‚æœå¤–éƒ¨è¿˜åœ¨ä½¿ç”¨ï¼Œå¯¹è±¡ä¸ä¼šè¢«é”€æ¯
        cache_.clear();
    }
};
```

### 2. å¼‚æ­¥ç¼–ç¨‹ï¼šå»¶é•¿å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
```cpp
class DataProcessor {
public:
    void processAsync(std::shared_ptr<Data> data) {
        // å¯åŠ¨å¼‚æ­¥ä»»åŠ¡ï¼Œdataçš„ç”Ÿå‘½å‘¨æœŸä¸ç¡®å®š
        std::thread([data]() {
            std::this_thread::sleep_for(std::chrono::seconds(5));
            // å³ä½¿è°ƒç”¨æ–¹å·²ç»ç»“æŸï¼Œdataä¾ç„¶æœ‰æ•ˆ
            processData(*data);
        }).detach();
    }
    
    // å¦‚æœç”¨unique_pträ¼šæ€æ ·ï¼Ÿ
    void processBad(std::unique_ptr<Data> data) {
        std::thread([&data]() {  // å±é™©ï¼å¼•ç”¨å¯èƒ½æ‚¬ç©º
            processData(*data);   // å¯èƒ½å´©æºƒ
        }).detach();
    }
};
```

### 3. èµ„æºæ± ï¼šå…±äº«æ˜‚è´µèµ„æº
```cpp
class DatabaseConnectionPool {
    std::vector<std::shared_ptr<Connection>> pool_;
public:
    std::shared_ptr<Connection> getConnection() {
        if (!pool_.empty()) {
            auto conn = pool_.back();
            pool_.pop_back();
            return conn;  // å¤šä¸ªå®¢æˆ·ç«¯å¯èƒ½åŒæ—¶ä½¿ç”¨åŒä¸€è¿æ¥
        }
        return std::make_shared<Connection>();
    }
    
    void returnConnection(std::shared_ptr<Connection> conn) {
        // ç®€å•åœ°æ”¾å›æ± ä¸­ï¼Œshared_pträ¼šè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
        // å³ä½¿æœ‰å…¶ä»–åœ°æ–¹è¿˜åœ¨ä½¿ç”¨è¿™ä¸ªè¿æ¥ï¼Œä¹Ÿæ²¡å…³ç³»
        // å½“æ‰€æœ‰å¼•ç”¨éƒ½é‡Šæ”¾åï¼Œè¿æ¥ä¼šè‡ªåŠ¨é”€æ¯
        pool_.push_back(conn);
    }
};
```

### 4. æ’ä»¶ç³»ç»Ÿï¼šå¤šæ¨¡å—å…±äº«
```cpp
class PluginManager {
    std::unordered_map<std::string, std::shared_ptr<Plugin>> plugins_;
public:
    std::shared_ptr<Plugin> loadPlugin(const std::string& name) {
        if (plugins_.find(name) == plugins_.end()) {
            plugins_[name] = std::make_shared<Plugin>(name);
        }
        return plugins_[name];  // å¤šä¸ªæ¨¡å—å¯èƒ½åŒæ—¶éœ€è¦åŒä¸€ä¸ªæ’ä»¶
    }
};

// ä½¿ç”¨åœºæ™¯
auto audioPlugin = pluginManager.loadPlugin("audio");
auto videoPlugin = pluginManager.loadPlugin("audio");  // è¿”å›åŒä¸€ä¸ªå®ä¾‹
// audioPluginå’ŒvideoPluginæŒ‡å‘åŒä¸€å¯¹è±¡ï¼Œä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥å®‰å…¨ä½¿ç”¨
```

## å®æˆ˜æŒ‡å—ï¼šå¦‚ä½•é€‰æ‹©æ™ºèƒ½æŒ‡é’ˆï¼Ÿ
éµå¾ªè¿™ä¸ªç®€å•çš„å†³ç­–æµç¨‹ï¼š

### ç¬¬ä¸€æ­¥ï¼šé»˜è®¤é€‰æ‹©unique_ptr
é™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™æ€»æ˜¯ä»unique_ptrå¼€å§‹ã€‚å®ƒæ€§èƒ½æœ€å¥½ï¼Œè¯­ä¹‰æœ€æ¸…æ™°ã€‚

### ç¬¬äºŒæ­¥ï¼šé‡åˆ°é—®é¢˜æ—¶å†è€ƒè™‘å‡çº§
+ **éœ€è¦è½¬ç§»æ‰€æœ‰æƒï¼Ÿ** â†’ ç»§ç»­ç”¨unique_ptr + std::move
+ **éœ€è¦å¤šä¸ªæ‹¥æœ‰è€…ï¼Ÿ** â†’ é—®è‡ªå·±ä¸‰ä¸ªé—®é¢˜ï¼š
    1. æ˜¯å¦çœŸçš„æœ‰å¤šä¸ª"æ‹¥æœ‰è€…"éœ€è¦è¿™ä¸ªå¯¹è±¡ï¼Ÿ
    2. è¿™äº›æ‹¥æœ‰è€…çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¦ä¸ç¡®å®šï¼Ÿ
    3. ä»»ä½•ä¸€ä¸ªæ‹¥æœ‰è€…éƒ½ä¸åº”è¯¥å•ç‹¬å†³å®šå¯¹è±¡ä½•æ—¶é”€æ¯ï¼Ÿ

å¦‚æœä¸‰ä¸ªç­”æ¡ˆéƒ½æ˜¯"æ˜¯"ï¼Œæ‰ç”¨shared_ptr

+ **å¯èƒ½æœ‰å¾ªç¯å¼•ç”¨ï¼Ÿ** â†’ ç”¨weak_ptræ‰“ç ´å¾ªç¯

## æ€»ç»“ï¼šæ™ºèƒ½æŒ‡é’ˆçš„"æ™ºæ…§"é€‰æ‹©

Googleæ¨èä¼˜å…ˆä½¿ç”¨unique_pträ¸æ˜¯æ²¡æœ‰é“ç†çš„ï¼š

1. **æ€§èƒ½æ›´å¥½**ï¼šæ²¡æœ‰å¼•ç”¨è®¡æ•°å¼€é”€
2. **å†…å­˜æ›´çœ**ï¼šåªæœ‰ä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°
3. **è®¾è®¡æ›´æ¸…æ™°**ï¼šæ˜ç¡®çš„æ‰€æœ‰æƒè¯­ä¹‰
4. **æ›´å®‰å…¨**ï¼šé¿å…å¾ªç¯å¼•ç”¨ç­‰é™·é˜±

è®°ä½è¿™ä¸ªåŸåˆ™ï¼š**èƒ½ç”¨unique_ptrå°±ä¸ç”¨shared_ptrï¼Œèƒ½ç”¨å¼•ç”¨å°±ä¸ç”¨æŒ‡é’ˆ**ã€‚

æœ€åæƒ³è¯´ï¼Œæ™ºèƒ½æŒ‡é’ˆçš„"æ™ºèƒ½"ä¸åœ¨äºåŠŸèƒ½æœ‰å¤šå¤æ‚ï¼Œè€Œåœ¨äºè®¾è®¡æ€è·¯çš„æ¸…æ™°å’Œä½¿ç”¨åœºæ™¯çš„å‡†ç¡®ã€‚å°±åƒå†™ä»£ç ä¸€æ ·ï¼Œç®€å•å¾€å¾€æ¯”å¤æ‚æ›´éš¾ï¼Œä½†ä¹Ÿæ›´æœ‰ä»·å€¼ã€‚

---

**å†™åœ¨æœ€å**

è¯´å®è¯ï¼Œå†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘æƒ³èµ·äº†åˆšå·¥ä½œæ—¶è¢«shared_ptrå‘å¾—æ­»å»æ´»æ¥çš„ç»å†ğŸ˜…ã€‚é‚£æ—¶å€™è§‰å¾—shared_ptrè¿™ä¹ˆ"æ™ºèƒ½"ï¼Œåº”è¯¥åˆ°å¤„ç”¨ï¼Œç»“æœè¸©äº†ä¸å°‘å‘ã€‚

å¦‚æœä½ ä¹Ÿåœ¨C++çš„è·¯ä¸Šæ‘¸çˆ¬æ»šæ‰“ï¼Œæˆ–è€…å¯¹Linuxåå°å¼€å‘æ„Ÿå…´è¶£ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œ**è·Ÿç€å°åº·å­¦ç¼–ç¨‹**ã€ã€‚æˆ‘ä¼šå®šæœŸåˆ†äº«ä¸€äº›å®æˆ˜è¸©å‘ç»éªŒï¼Œéƒ½æ˜¯å·¥ä½œä¸­çœŸå®é‡åˆ°çš„é—®é¢˜ï¼Œ ç»å¯¹ä¸æ˜¯é‚£ç§ç½‘ä¸Šéšå¤„å¯è§çš„æ•™ç§‘ä¹¦å¼åºŸè¯ã€‚  

## ğŸš€ è·Ÿæˆ‘å­¦ï¼Œä½ èƒ½æ”¶è·å•¥ï¼Ÿ

åœ¨è¿™é‡Œï¼Œä½ ä¸ä»…èƒ½çœ‹åˆ°å¹²è´§ï¼Œè¿˜èƒ½çœŸæ­£å­¦åˆ°èƒ½ç”¨çš„æŠ€èƒ½ï¼š

+ **Linux å®æˆ˜æŠ€å·§**ï¼šæœåŠ¡å™¨è°ƒä¼˜ã€å¸¸ç”¨å‘½ä»¤ã€Shell è„šæœ¬ï¼Œè®©ä½ åƒé«˜æ‰‹ä¸€æ ·æ“ä½œç³»ç»Ÿã€‚
+ **C/C++ åå°å¼€å‘**ï¼šä»åŸºç¡€è¯­æ³•åˆ°é«˜æ€§èƒ½ç¼–ç¨‹ï¼Œå¸¦ä½ å†™å‡ºç¨³ã€å¿«ã€å¯ç»´æŠ¤çš„æœåŠ¡ç«¯ä»£ç ã€‚
+ **C/C++ é¡¹ç›®å®æˆ˜**ï¼šçœŸå®é¡¹ç›®æ¡ˆä¾‹ï¼Œæ•™ä½ ä»éœ€æ±‚åˆ°ä¸Šçº¿å®Œæ•´æµç¨‹ï¼ŒæŒæ¡å¼€å‘å¥—è·¯å’Œæœ€ä½³å®è·µã€‚
+ **å¸¸ç”¨å¼€å‘å·¥å…·**ï¼šè°ƒè¯•ã€ç‰ˆæœ¬æ§åˆ¶ã€æ„å»ºå·¥å…·ã€æ€§èƒ½åˆ†æå·¥å…·ï¼Œè®©å¼€å‘æ•ˆç‡å¤§å¹…æå‡ã€‚
+ **æ€§èƒ½ä¼˜åŒ–**ï¼šCPU/å†…å­˜/IO è°ƒä¼˜æŠ€å·§ï¼Œå®šä½ç“¶é¢ˆï¼Œè®©ä½ çš„ç¨‹åºè·‘å¾—æ›´å¿«æ›´ç¨³ã€‚
+ **é¡¹ç›®æ¶æ„è®¾è®¡**ï¼šå¾®æœåŠ¡ã€åˆ†å±‚æ¶æ„ã€æ¨¡å—è®¾è®¡æ€è·¯ï¼Œå¸®ä½ æ„å»ºå¯æ‰©å±•ã€æ˜“ç»´æŠ¤çš„ç³»ç»Ÿã€‚
+ **Go åç«¯å¼€å‘**ï¼šå¾®æœåŠ¡ã€äº‘åŸç”Ÿå®æˆ˜ï¼Œæ•™ä½ ç”¨ Go æ­å»ºé«˜å¹¶å‘ã€é«˜å¯ç”¨ç³»ç»Ÿã€‚
+ **ç¼–ç¨‹é¢è¯•å¹²è´§ & ç®—æ³•**ï¼šæ ¸å¿ƒç®—æ³•å¥—è·¯ã€é¢è¯•é«˜é¢‘é¢˜è§£æï¼Œè®©ä½ ä¸å†æ‰‹å¿™è„šä¹±ã€‚
+ **è®¡ç®—æœºåŸºç¡€æ¢³ç†**ï¼šæ“ä½œç³»ç»Ÿã€ç½‘ç»œã€æ•°æ®ç»“æ„ã€å¹¶å‘åŸç†ï¼ŒçŸ¥è¯†ä½“ç³»æ¸…æ™°æ˜äº†ã€‚
+ **æˆé•¿è·¯çº¿å›¾**ï¼šç³»ç»Ÿè§„åˆ’ä½ çš„å­¦ä¹ è·¯å¾„ï¼Œä»åˆå­¦åˆ°é«˜çº§ï¼Œå¸®ä½ å°‘èµ°å¼¯è·¯ã€‚

å†…å®¹**æ·±å…¥æµ…å‡ºã€å®ç”¨æœ‰è¶£**ï¼Œå†ä¹Ÿä¸ç”¨çœ‹ä¹¦çœ‹åˆ°ç¡ç€ã€‚  
æ— è®ºæ˜¯é¢è¯•å†²åˆºï¼Œè¿˜æ˜¯æŠ€èƒ½å‡çº§ï¼Œè¿™é‡Œéƒ½æ˜¯ä½ çš„â€œæŠ€æœ¯åŠ æ²¹ç«™â€ã€‚


## ğŸ‘€ æƒ³åŠ å…¥ï¼Ÿå¾ˆç®€å•ï¼
**æ‰«ä¸€æ‰«ä¸‹é¢äºŒç»´ç **ï¼Œä¸€é”®å…³æ³¨å…¬ä¼—å·ï¼Œå¼€å¯ä½ çš„æŠ€æœ¯å­¦ä¹ ä¹‹æ—…ï¼

![](https://files.mdnice.com/user/71186/0dde803d-d52f-4ed8-b74b-b7f3da5817b9.png)

å¦å¤–ï¼Œæˆ‘è¿˜å»ºäº†ä¸€ä¸ª**æŠ€æœ¯äº¤æµç¾¤**ï¼Œé‡Œé¢éƒ½æ˜¯è®¤çœŸå†™ä»£ç çš„å°ä¼™ä¼´ï¼Œä¸å¹ç‰›ã€ä¸é—²èŠï¼ŒåªèŠæŠ€æœ¯ã€‚  
æœ‰é—®é¢˜ï¼Ÿå¤§å®¶ä¸€å—å„¿è®¨è®ºï¼Œæ¯”ä¸€ä¸ªäººé—·å¤´å­¦æ•ˆç‡é«˜å¤šäº†ï¼

![](https://files.mdnice.com/user/48364/4ebc72e9-e4bb-447a-9a92-8367a178df6d.png)

æŠ€æœ¯è¿™æ¡è·¯ï¼Œä¸€ä¸ªäººèµ°å®¹æ˜“è¿·è·¯ï¼Œä¸€ç¾¤äººèµ°æ‰æœ‰æ–¹å‘ã€‚  
è·Ÿä¸ŠèŠ‚å¥ï¼Œæˆ‘ä»¬ä¸€èµ·å˜å¼º ğŸ’ª