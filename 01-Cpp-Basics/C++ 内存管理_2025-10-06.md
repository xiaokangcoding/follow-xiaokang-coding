### å‰è¨€
å­¦ C++ çš„äººéƒ½å¬è¿‡ä¸€å¥è¯ï¼š

>â€œC++ æ˜¯ä¸€é—¨è‡ªç”±çš„è¯­è¨€ï¼Œç»™äº†ä½ æ— é™çš„å¯èƒ½æ€§ï¼Œä¹Ÿç»™äº†ä½ æ— æ•°çš„å‘ã€‚â€

å…¶ä¸­æœ€å¤§çš„å‘ï¼Œå°±æ˜¯ **å†…å­˜ç®¡ç†**ã€‚

æœ‰æ²¡æœ‰é‡åˆ°è¿™ç§åœºæ™¯ï¼š

+ ç¨‹åºçªç„¶å´©æºƒï¼ŒæŠ¥äº†ä¸ª **Segmentation Fault**ï¼Œä½ ä¸€è„¸æ‡µé€¼ï¼›
+ ç¨‹åºè¿è¡Œä¸­ï¼Œå†…å­˜å ç”¨ä¸æ–­å¢åŠ ï¼Œæœ€åå¯¼è‡´å¡é¡¿ç”šè‡³å´©æºƒï¼›
+ ç”¨äº† `delete`ï¼Œç»“æœåˆ å¤šäº†ï¼Œç¨‹åºç›´æ¥ **GG**â€¦â€¦

åˆ«æ…Œï¼å†…å­˜ç®¡ç†å…¶å®æ²¡é‚£ä¹ˆå¤æ‚ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ç”¨æœ€é€šä¿—æ˜“æ‡‚çš„æ–¹å¼ï¼Œä¸€æ­¥æ­¥ææ¸…æ¥š C++ å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæ¦‚å¿µã€‚

çœ‹å®Œè¿™ç¯‡ï¼Œä½ ä¼šæœ‰ç§ **â€œå“¦ï¼ŒåŸæ¥æ˜¯è¿™ä¹ˆå›äº‹ï¼â€** çš„æ„Ÿè§‰ã€‚  
æˆ‘ä»¬ä¸åªè®²åŸç†ï¼Œè¿˜æ•™ä½  **é¿å‘æŠ€å·§**ï¼Œè®©ä½ çš„ç¨‹åºæ›´ç¨³ã€æ›´é«˜æ•ˆã€‚

> ğŸ’¡ å­¦ä¹ å»ºè®®ï¼š

> **åŠ¨æ‰‹è§‚å¯Ÿå†…å­˜**ï¼šç”¨è°ƒè¯•å™¨ã€å†…å­˜åˆ†æå·¥å…·çœ‹çœ‹æ ˆã€å †ã€å…¨å±€åŒºçš„åˆ†å¸ƒï¼Œæ¯”çº¸ä¸Šè°ˆå…µç›´è§‚å¾—å¤šã€‚
>
> **ç†è§£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ**ï¼šåŒºåˆ†å±€éƒ¨å˜é‡ã€åŠ¨æ€åˆ†é…å¯¹è±¡å’Œé™æ€å˜é‡çš„å†…å­˜ç®¡ç†æ–¹å¼ï¼Œèƒ½é¿å…å¾ˆå¤šå¸¸è§é”™è¯¯ã€‚
>
> **å¤šå†™ç¤ºä¾‹**ï¼šå°è¯•ç”³è¯·ã€é‡Šæ”¾å†…å­˜ï¼Œæ•…æ„åˆ¶é€ å°é”™è¯¯çœ‹çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œå®è·µä¸­è®°å¿†æ›´ç‰¢ã€‚
>
> **å…³æ³¨å¼‚å¸¸æƒ…å†µ**ï¼šæ¯”å¦‚é‡å¤é‡Šæ”¾ã€é‡æŒ‡é’ˆã€å†…å­˜æ³„æ¼ç­‰ï¼Œè¿™äº›æ˜¯ C++ ç¨‹åºå¸¸è§å‘ç‚¹ã€‚
>
>æƒ³ç³»ç»Ÿå­¦ä¹ æ›´å¤š C++ çŸ¥è¯†ï¼Ÿæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Œ**è·Ÿç€å°åº·ç¼–ç¨‹**ã€ï¼Œæˆ‘ä¼šæŒç»­æ›´æ–° Cã€ C++ã€Linuxã€åç«¯å¼€å‘ç­‰é«˜è´¨é‡æŠ€æœ¯æ–‡ç« ã€‚ä¹Ÿå¯ä»¥åŠ æˆ‘çš„ä¸ªäººå¾®ä¿¡ï¼Œä¸€èµ·è¿›ç¾¤è®¨è®ºå­¦ä¹ ï¼
>
> 
> <table>
> <tr>
> <td align="center">
> <img src="https://github.com/xiaokangcoding/follow-xiaokang-coding/raw/main/images/qrcode-wechat-official.png" width="200">
> <br>
> <em>å…¬ä¼—å·ã€Œè·Ÿç€å­¦å°åº·ç¼–ç¨‹ã€</em>
> </td>
> <td align="center">
> <img src="https://github.com/xiaokangcoding/follow-xiaokang-coding/raw/main/images/qrcode-personal-wechat.png" width="200">
> <br>
> <em>ä¸ªäººå¾®ä¿¡ï¼ˆå¤‡æ³¨ï¼šåŠ ç¾¤ï¼‰</em>
> </td>
> </tr>
> </table>


## 1. å†…å­˜çš„å¤§å¦ï¼šC++ ç¨‹åºçš„å†…å­˜åˆ†å±‚

C++ ç¨‹åºçš„å†…å­˜å¸ƒå±€å°±åƒä¸€æ ‹å¤§æ¥¼ï¼Œæ¯ä¸€å±‚æ¥¼éƒ½æœ‰æ˜ç¡®çš„åŠŸèƒ½åˆ†åŒºï¼š

```diff

+-------------------+ <- é«˜åœ°å€
|       æ ˆåŒº        |  ä¸´æ—¶æ•°æ®ï¼Œè‡ªåŠ¨ç®¡ç† (æ ˆåŒºä»é«˜åœ°å€å‘ä½åœ°å€å¢é•¿)
+-------------------+  
|       ç©ºé—²åŒº      |  æ ˆåŒºå’Œå †åŒºä¹‹é—´çš„æœªåˆ†é…å†…å­˜
+-------------------+
|       å †åŒº        |  åŠ¨æ€åˆ†é…çš„å†…å­˜(ä»ä½åœ°å€å‘é«˜åœ°å€å¢é•¿)
+-------------------+
|     æ•°æ®æ®µï¼ˆDataï¼‰|  å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€é™æ€å˜é‡
+-------------------+
|       BSS æ®µ      |  æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€é™æ€å˜é‡ï¼ˆé»˜è®¤æ¸…é›¶ï¼‰
+-------------------+
|       ä»£ç åŒº      |  ç¨‹åºæŒ‡ä»¤ï¼Œæœºå™¨è¯­è¨€ï¼ˆåªè¯»ï¼‰
+-------------------+ <- ä½åœ°å€
```

## åˆ†åŒºè¯¦è§£ï¼šæ¯å±‚æ¥¼éƒ½æœ‰å•¥ï¼Ÿ

### 1.1 æ ˆå†…å­˜ï¼šç¨‹åºçš„å¿«é€’æŸœ

æ ˆï¼ˆStackï¼‰å°±åƒå¿«é€’æŸœï¼Œå­˜ä¸œè¥¿(æ•°æ®)å¿«ï¼Œå–ä¸œè¥¿ä¹Ÿå¿«ï¼Œå­˜å–æ•ˆç‡å¾ˆé«˜ã€‚ä½†ç©ºé—´æœ‰é™ï¼Œå¡å¤ªå¤šä¸œè¥¿ä¼šçˆ†æ‰ã€‚

#### ç‰¹ç‚¹ï¼š
+ è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ï¼Œä¸éœ€è¦ä½ æ“å¿ƒï¼Œå‡½æ•°ç»“æŸåï¼Œå­˜çš„ä¸œè¥¿(æ•°æ®)å°±ä¼šè‡ªåŠ¨æ¸…ç©ºã€‚
+ ç©ºé—´æ¯”è¾ƒå°ï¼Œä¸€èˆ¬å‡  MBï¼Œé€‚åˆå­˜æ”¾ä¸´æ—¶å˜é‡ï¼Œæ¯”å¦‚å‡½æ•°é‡Œçš„å±€éƒ¨å˜é‡ã€‚

#### ä¾‹å­ï¼š
```c++
void foo() {
    int x = 10;  // x æ”¾åœ¨æ ˆä¸Š
}  // å‡½æ•°ç»“æŸæ—¶ï¼Œx è‡ªåŠ¨é‡Šæ”¾
```

### 1.2 å †å†…å­˜ï¼šç¨‹åºçš„å¤§ä»“åº“

å †ï¼ˆHeapï¼‰å°±åƒä»“åº“ï¼Œåœ°æ–¹å¤§ï¼Œä½†å­˜å–ä¸œè¥¿(æ•°æ®)æ²¡æœ‰æ ˆé‚£ä¹ˆå¿«ï¼Œè€Œä¸”éœ€è¦ä½ è‡ªå·±åŠ¨æ‰‹æ”¶æ‹¾ï¼ˆåˆ†é…å’Œé‡Šæ”¾ï¼‰ã€‚

#### **ç‰¹ç‚¹**ï¼š
+ ç©ºé—´å¤§ï¼Œé€‚åˆå­˜æ”¾éœ€è¦é•¿æœŸå­˜åœ¨çš„æ•°æ®ï¼Œæ¯”å¦‚åŠ¨æ€æ•°ç»„ã€‚
+ éœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼Œç”¨ `new` åˆ†é…ï¼Œç”¨ `delete` é‡Šæ”¾ã€‚å¦‚æœå¿˜è®°é‡Šæ”¾ï¼Œå†…å­˜å°±ä¼šæ³„æ¼ã€‚

#### **ä¾‹å­**ï¼š
```c++
void foo() {
    int* p = new int(10);  // åœ¨å †ä¸Šåˆ†é…ä¸€ä¸ªæ•´æ•°
    delete p;             // æ‰‹åŠ¨é‡Šæ”¾å†…å­˜
}
```

### 1.3 æ•°æ®æ®µï¼šç¨‹åºçš„å‚¨ç‰©é—´

æ•°æ®æ®µï¼ˆData Segmentï¼‰æ˜¯ç¨‹åºçš„â€œå‚¨ç‰©é—´â€ï¼Œç”¨æ¥æ”¾å·²ç»åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œä¸œè¥¿æ”¾è¿›å»å°±ä¸åŠ¨äº†ï¼Œç›´åˆ°ç¨‹åºç»“æŸæ‰ä¼šæ¸…ç©ºã€‚

#### ç‰¹ç‚¹ï¼š
+ æ”¾å·²ç»åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œæ¯”å¦‚ `int x = 10;`ã€‚
+ ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œè¿™äº›å˜é‡ä¸€ç›´éƒ½åœ¨ã€‚

#### ä¾‹å­ï¼š

```c++
int x = 10;           // å…¨å±€å˜é‡ï¼Œå­˜æ”¾åœ¨æ•°æ®æ®µ
static int count = 42; // é™æ€å˜é‡ï¼Œä¹Ÿå­˜æ”¾åœ¨æ•°æ®æ®µ
```

### 1.4 BSS æ®µï¼šç¨‹åºçš„â€œç©ºè´§æ¶â€

BSS æ®µ å°±æ˜¯ç¨‹åºçš„â€œç©ºè´§æ¶â€ï¼Œä¸“é—¨ç”¨æ¥æ”¾é‚£äº› **æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡**ã€‚è¿™äº›å˜é‡è™½ç„¶ä¸€å¼€å§‹æ²¡æœ‰èµ‹å€¼ï¼Œä½†è´§æ¶çš„ä½ç½®(å†…å­˜)å·²ç»é¢„ç•™å¥½äº†ï¼Œè€Œä¸”ç³»ç»Ÿä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶å¸®ä½ æŠŠè¿™äº›è´§æ¶æ¸…ç†å¹²å‡€ï¼ˆè‡ªåŠ¨æ¸…é›¶ï¼‰ã€‚

#### ç‰¹ç‚¹ï¼š
+ å­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œæ¯”å¦‚ `int x;` å’Œ `static int count;`ã€‚
+ ç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…é›¶ï¼Œç¡®ä¿æ‰€æœ‰å˜é‡çš„åˆå§‹å€¼ä¸º 0ï¼Œé¿å…å‡ºç°åƒåœ¾æ•°æ®ã€‚
+ å˜é‡åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°ç¨‹åºç»“æŸæ‰ä¼šé‡Šæ”¾ã€‚

#### ä¾‹å­ï¼š
```c++
int x;           // æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œå­˜æ”¾åœ¨ BSS æ®µï¼Œé»˜è®¤å€¼ä¸º 0
static int count; // æœªåˆå§‹åŒ–çš„é™æ€å˜é‡ï¼Œä¹Ÿå­˜æ”¾åœ¨ BSS æ®µï¼Œé»˜è®¤å€¼ä¸º 0
```

#### è§£é‡Šï¼š
+ å½“ä½ å£°æ˜ `int x;` æ—¶ï¼Œè™½ç„¶æ²¡æœ‰æ˜¾å¼èµ‹å€¼ï¼Œä½†ç³»ç»Ÿå·²ç»ä¸ºå®ƒåœ¨ BSS æ®µåˆ†é…äº†å†…å­˜ï¼Œå¹¶é»˜è®¤å°†å…¶æ¸…é›¶ï¼ˆ`x = 0`ï¼‰ã€‚
+ åŒæ ·ï¼Œ`static int count;` ä½œä¸ºæœªåˆå§‹åŒ–çš„é™æ€å˜é‡ï¼Œä¹Ÿä¼šè¢«æ”¾åœ¨ BSS æ®µï¼Œå¹¶ç”±ç³»ç»Ÿé»˜è®¤èµ‹å€¼ä¸º 0ã€‚ 

### 1.5 ä»£ç åŒºï¼šç¨‹åºçš„è¯´æ˜ä¹¦

ä»£ç åŒºï¼ˆCode Segmentï¼‰å°±æ˜¯ç¨‹åºçš„â€œè¯´æ˜ä¹¦â€ï¼Œæ”¾çš„å…¨æ˜¯ä»£ç æŒ‡ä»¤ï¼Œå‘Šè¯‰ CPU æ€ä¹ˆä¸€æ­¥æ­¥æ‰§è¡Œã€‚

#### ç‰¹ç‚¹ï¼š

+ æ”¾ç¼–è¯‘åçš„ç¨‹åºæŒ‡ä»¤ï¼Œæ¯”å¦‚å‡½æ•°çš„ä»£ç ã€‚
+ æ˜¯åªè¯»çš„ï¼Œé˜²æ­¢ä»£ç è¢«ä¿®æ”¹ï¼Œä¿è¯å®‰å…¨ã€‚

#### ä¾‹å­ï¼š

```c++
void foo() {
    // foo å‡½æ•°çš„æŒ‡ä»¤å­˜æ”¾åœ¨ä»£ç åŒº
}
```

### 1.6 å†…å­˜åˆ†é…ç­–ç•¥ï¼šå†…å­˜åˆ°åº•æ˜¯æ€ä¹ˆåˆ†é…çš„ï¼Ÿ

åœ¨ C++ çš„ä¸–ç•Œé‡Œï¼Œå†…å­˜ç®¡ç†æœ‰ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼šåˆ†é…å†…å­˜ å’Œ é‡Šæ”¾å†…å­˜ã€‚ä½†ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå†…å­˜åˆ°åº•æ˜¯æ€ä¹ˆåˆ†é…çš„ï¼Ÿè°æ¥å†³å®šå®ƒæ”¾åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šï¼Ÿç­”æ¡ˆæ˜¯ï¼šè¿™å–å†³äºå†…å­˜åˆ†é…ç­–ç•¥ã€‚

å†…å­˜åˆ†é…ä¸»è¦åˆ†ä¸ºä¸‰ç§ç­–ç•¥ï¼š

**1. é™æ€åˆ†é…**

**2. æ ˆåˆ†é…**

**3. å †åˆ†é…**

æ¯ç§åˆ†é…æ–¹å¼å„æœ‰ç‰¹ç‚¹ï¼Œå’±ä»¬ç”¨ç®€å•çš„ç±»æ¯”æ¥ä¸€ä¸€ææ‡‚ã€‚

#### 1. é™æ€åˆ†é…ï¼šä½ çš„å›ºå®šè½¦ä½

é™æ€åˆ†é…ï¼ˆStatic Allocationï¼‰æ˜¯æœ€ç®€å•çš„ä¸€ç§åˆ†é…æ–¹å¼ï¼Œå°±åƒä½ å®¶å°åŒºåˆ†ç»™ä½ çš„å›ºå®šåœè½¦ä½ï¼Œè½¦ä½æ˜¯å›ºå®šçš„ï¼Œæ°¸è¿œåœ¨é‚£é‡Œï¼Œæ— éœ€æŠ¢å ã€‚

**ç‰¹ç‚¹**ï¼š

+ å†…å­˜å¤§å°å’Œåœ°å€åœ¨ **ç¼–è¯‘æ—¶** å°±ç¡®å®šäº†ã€‚
+ ç¨‹åºå¯åŠ¨æ—¶åˆ†é…ï¼Œç¨‹åºç»“æŸæ—¶é‡Šæ”¾ã€‚
+ é€šå¸¸ç”¨äºå…¨å±€å˜é‡ã€é™æ€å˜é‡å’Œå¸¸é‡(`const`)ã€‚

**ä¼˜ç‚¹**ï¼š

+ åˆ†é…å’Œé‡Šæ”¾éƒ½ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼Œå®‰å…¨çœå¿ƒã€‚
+ ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå†…å­˜åœ°å€ä¸å˜ï¼Œè®¿é—®æ•ˆç‡é«˜ã€‚

**ç¼ºç‚¹**ï¼š

+ çµæ´»æ€§å·®ï¼Œæ— æ³•åœ¨è¿è¡Œæ—¶è°ƒæ•´å†…å­˜å¤§å°ã€‚

**ä¾‹å­**ï¼š

```c++
int x = 42;           // é™æ€åˆ†é…çš„å…¨å±€å˜é‡
static int count = 0; // é™æ€å˜é‡
const int MAX = 100;  // å¸¸é‡
```

#### 2. æ ˆåˆ†é…ï¼šå…±äº«çš„å¿«é€’æŸœ

æ ˆåˆ†é…ï¼ˆStack Allocationï¼‰ç±»ä¼¼äºå†™å­—æ¥¼é‡Œçš„å…±äº«å¿«é€’æŸœï¼Œç”¨çš„æ—¶å€™ä¸´æ—¶å­˜ä¸€ä¸‹ï¼Œç”¨å®Œç«‹é©¬è…¾å‡ºæ¥ï¼Œè°å¿«è°å…ˆç”¨ã€‚

**ç‰¹ç‚¹**ï¼š

+ å†…å­˜åˆ†é…å’Œé‡Šæ”¾ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼ŒåŸºäºå‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
+ åˆ†é…æ•ˆç‡é«˜ï¼Œä½†ç©ºé—´æœ‰é™ï¼ˆå‡  MBï¼‰ã€‚

**ä¼˜ç‚¹**ï¼š

+ æ“ä½œç®€å•ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†ã€‚
+ å› ä¸ºæ ˆæ˜¯è¿ç»­åˆ†å¸ƒçš„ï¼Œè®¿é—®æ•ˆç‡å¾ˆé«˜ã€‚

**ç¼ºç‚¹**ï¼š

+ ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸåï¼Œå†…å­˜ä¼šè¢«ç«‹å³å›æ”¶ã€‚
+ ç©ºé—´å°ï¼Œä¸é€‚åˆå­˜å‚¨å¤§æ•°æ®ã€‚

**ä¾‹å­**ï¼š

```c++
void foo() {
    int x = 10;  // x æ˜¯æ ˆåˆ†é…çš„å±€éƒ¨å˜é‡
}  // å‡½æ•°ç»“æŸåï¼Œx è¢«è‡ªåŠ¨é‡Šæ”¾
```

#### 3. å †åˆ†é…ï¼šçµæ´»çš„å¤§ä»“åº“

å †åˆ†é…ï¼ˆHeap Allocationï¼‰å°±åƒç§Ÿç”¨çš„å¤§ä»“åº“ï¼Œä½ å¯ä»¥éšæ„å†³å®šå­˜æ”¾ä»€ä¹ˆã€å­˜å¤šä¹…ï¼Œä½†ä¹Ÿå¾—è‡ªå·±è´Ÿè´£æ‰“æ‰«å’Œç®¡ç†ã€‚

**ç‰¹ç‚¹**ï¼š

+ å†…å­˜åˆ†é…å’Œé‡Šæ”¾å®Œå…¨ç”±ç¨‹åºå‘˜æ§åˆ¶ï¼ˆé€šè¿‡ `new` å’Œ `delete`ï¼‰ã€‚
+ æ›´çµæ´»ï¼Œå¯ä»¥å­˜å‚¨è¿è¡Œæ—¶æ‰çŸ¥é“å¤§å°çš„æ•°æ®ï¼Œæ¯”å¦‚åŠ¨æ€æ•°ç»„æˆ–å¯¹è±¡ã€‚

**ä¼˜ç‚¹**ï¼š

+ ç©ºé—´å¤§ï¼Œé€‚åˆå­˜å‚¨éœ€è¦é•¿æœŸå­˜åœ¨çš„å¤§æ•°æ®ã€‚
+ ç”Ÿå‘½å‘¨æœŸçµæ´»ï¼Œç¨‹åºå‘˜å¯ä»¥å†³å®šå†…å­˜ä½•æ—¶é‡Šæ”¾ã€‚

**ç¼ºç‚¹**ï¼š

+ æ“ä½œå¤æ‚ï¼Œå¦‚æœå¿˜è®°é‡Šæ”¾ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚
+ å› ä¸ºå †æ˜¯ç¦»æ•£åˆ†å¸ƒçš„ï¼Œè®¿é—®æ•ˆç‡ç•¥ä½ã€‚

**ä¾‹å­**ï¼š

```c++
void foo() {
    int* p = new int(42);  // åœ¨å †ä¸Šåˆ†é…å†…å­˜
    delete p;             // æ‰‹åŠ¨é‡Šæ”¾å†…å­˜
}
```

#### å°ç»“ï¼šé€‰æ‹©åˆé€‚çš„å†…å­˜åˆ†é…ç­–ç•¥

| **åˆ†é…æ–¹å¼** | **é€‚åˆåœºæ™¯** | **ç”±è°ç®¡ç†** | **ä¼˜ç¼ºç‚¹** |
| --- | --- | --- | --- |
| é™æ€åˆ†é… | å…¨å±€å˜é‡ã€é™æ€å˜é‡ã€å¸¸é‡ï¼ˆ`const`ï¼‰ | ç¼–è¯‘å™¨å’Œæ“ä½œç³»ç»Ÿè‡ªåŠ¨ | å¿«é€Ÿç¨³å®šï¼Œçµæ´»æ€§å·® |
| æ ˆåˆ†é… | ä¸´æ—¶å˜é‡ã€å‡½æ•°å±€éƒ¨å˜é‡ | ç¼–è¯‘å™¨è‡ªåŠ¨ | é«˜æ•ˆä½†ç©ºé—´æœ‰é™ |
| å †åˆ†é… | éœ€è¦åŠ¨æ€åˆ†é…å’Œé‡Šæ”¾çš„å¤æ‚æ•°æ®ç»“æ„ | ç¨‹åºå‘˜æ‰‹åŠ¨ | çµæ´»ä½†å®¹æ˜“å‡ºé”™ |


**è®°ä½**ï¼šç¨‹åºå‘˜çš„ä¸»è¦å·¥ä½œæ˜¯ç®¡ç†â€œå †åˆ†é…â€çš„å†…å­˜ï¼Œè€Œé™æ€åˆ†é…å’Œæ ˆåˆ†é…é€šå¸¸æ˜¯è‡ªåŠ¨å®Œæˆçš„ã€‚æ‰€ä»¥åœ¨ç”¨å †åˆ†é…å†…å­˜æ—¶ï¼Œåƒä¸‡åˆ«å¿˜äº†åŠæ—¶é‡Šæ”¾ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼

## 2. C++ å†…å­˜ç®¡ç†çš„æ ¸å¿ƒå·¥å…·ï¼š`new` å’Œ `delete`

åœ¨ C++ ç¨‹åºçš„å†…å­˜å¸ƒå±€ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°å †åŒºæ˜¯ä¸€ä¸ªâ€œçµæ´»çš„å¤§ä»“åº“â€ï¼Œé€‚åˆå­˜æ”¾éœ€è¦åŠ¨æ€åˆ†é…çš„æ•°æ®ï¼Œæ¯”å¦‚è¿è¡Œæ—¶å†³å®šå¤§å°çš„æ•°ç»„ã€å¯¹è±¡ç­‰ã€‚ä½†è¿™ä¸ªä»“åº“çš„ç®¡ç†å¹¶ä¸æ˜¯è‡ªåŠ¨çš„ï¼Œå®ƒéœ€è¦ç¨‹åºå‘˜äº²è‡ªæ‰“ç†ï¼š**åˆ†é…ç©ºé—´ã€ä½¿ç”¨ç©ºé—´ã€é‡Šæ”¾ç©ºé—´ã€‚**

è¿™æ—¶ï¼ŒC++ æä¾›äº†ä¸¤ä¸ªå¼ºå¤§çš„å·¥å…·â€”â€” `new`  å’Œ `delete`ï¼Œå®ƒä»¬å°±åƒä¸¤ä½ä¸“ä¸šçš„â€œä»“åº“ç®¡ç†å‘˜â€ï¼Œè´Ÿè´£åœ¨å †åŒºä¸ºä½ åˆ†é…å’Œå½’è¿˜å†…å­˜ã€‚

è€Œåœ¨è¿™ä¹‹å‰ï¼ŒC è¯­è¨€çš„å¼€å‘è€…ä¾é  `malloc `å’Œ `free` ç®¡ç†å †å†…å­˜ï¼Œè¿™ä¸¤ä¸ªå·¥å…·è™½ç„¶ç®€å•å¯é ï¼Œä½†ç›¸è¾ƒäº C++ çš„æ–°å·¥å…·ï¼Œæ˜¾å¾—æœ‰äº›ç¬¨æ‹™äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸¤ä»£â€œç®¡ç†å‘˜â€çš„ç‰¹ç‚¹ï¼Œå…ˆä» `new` å’Œ `delete` å¼€å§‹ï¼

### 2.1  `new`ï¼šåˆ†é…å †å†…å­˜

`new` æ˜¯ C++ çš„ä¸“å±å·¥å…·ï¼Œç”¨æ¥åˆ†é…å †å†…å­˜ï¼Œå¹¶è¿”å›æŒ‡å‘è¿™å—å†…å­˜çš„æŒ‡é’ˆã€‚ä½ è¿˜å¯ä»¥é¡ºä¾¿åˆå§‹åŒ–è¿™å—å†…å­˜é‡Œçš„å€¼ã€‚

#### ç¤ºä¾‹ï¼š

```c++
int* p = new int(42);  // åˆ†é…ä¸€ä¸ªæ•´æ•°ï¼Œå¹¶åˆå§‹åŒ–ä¸º 42
```

+ **ä½œç”¨ï¼š** åˆ†é…ä¸€å—å †å†…å­˜ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒã€‚
+ **ä¼˜ç‚¹ï¼š** ä½¿ç”¨ç®€å•ï¼Œæ”¯æŒå¯¹è±¡åˆå§‹åŒ–ï¼ˆè¿™æ˜¯ `malloc` åšä¸åˆ°çš„ï¼‰ã€‚

### 2.2  `delete`ï¼šé‡Šæ”¾å †å†…å­˜

åˆ†é…äº†å †å†…å­˜åï¼Œè®°å¾—ç”¨ `delete` å½’è¿˜ï¼Œå¦åˆ™ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œè¿™å°±åƒä½ å ç”¨äº†åœè½¦ä½å´è¿Ÿè¿Ÿä¸æŒªè½¦ï¼Œå¯¼è‡´åœè½¦åœºçš„è½¦ä½è¢«å æ»¡ï¼Œå…¶ä»–äººä¹Ÿæ²¡åœ°æ–¹åœè½¦äº†ã€‚

#### ç¤ºä¾‹ï¼š
```c++
delete p;  // é‡Šæ”¾ç”¨ new åˆ†é…çš„å†…å­˜
p = NULLï¼› // å¥½ä¹ æƒ¯ï¼šdelete ä¹‹åï¼ŒæŒ‡é’ˆè¦èµ‹å€¼ä¸ºç©º
```

+ **ä½œç”¨ï¼š** é‡Šæ”¾å †å†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚
+ **æ³¨æ„ï¼š** æ¯æ¬¡ `new` éƒ½å¿…é¡» `delete`ï¼Œå¦åˆ™å †å†…å­˜ä¼šæ³„æ¼ã€‚

### 2.3  æ•°ç»„çš„å†…å­˜åˆ†é…

å¦‚æœä½ è¦åˆ†é…ä¸€å—è¿ç»­çš„å †å†…å­˜ï¼ˆæ¯”å¦‚æ•°ç»„ï¼‰ï¼Œå¯ä»¥ç”¨ `new[]` å’Œ `delete[]`ã€‚

#### ç¤ºä¾‹ï¼š
```c++
int* arr = new int[10];  // åˆ†é…ä¸€ä¸ªæ•°ç»„
delete[] arr;            // ä½¿ç”¨ delete[] é‡Šæ”¾
```

+ **ä½œç”¨ï¼š**`new[]` åˆ†é…è¿ç»­å†…å­˜ï¼Œ`delete[]` ç”¨äºé‡Šæ”¾å®ƒã€‚
+ **æ³¨æ„ï¼š** å¦‚æœåˆ†é…çš„æ˜¯æ•°ç»„ï¼Œå¿…é¡»ç”¨ `delete[]`ï¼Œä¸èƒ½ç”¨æ™®é€šçš„ `delete`ï¼Œå¦åˆ™ä¼šå‡ºç°æœªå®šä¹‰è¡Œä¸ºã€‚

### 2.4  `malloc` å’Œ `free`ï¼šC è¯­è¨€çš„è€æœ‹å‹

`malloc` å’Œ `free` æ˜¯ C è¯­è¨€é‡Œçš„å†…å­˜åˆ†é…å·¥å…·ï¼Œå®ƒä»¬ä¹Ÿèƒ½åœ¨ C++ ä¸­ç”¨ï¼Œä½†ä¸ `new` å’Œ `delete` æœ‰ä¸€äº›å…³é”®åŒºåˆ«ï¼š

#### `malloc` çš„ç‰¹ç‚¹ï¼š

1. åªåˆ†é…å†…å­˜ï¼Œä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°ã€‚
2. éœ€è¦æŒ‡å®šåˆ†é…çš„å¤§å°ã€‚
3. è¿”å› `void*` ç±»å‹ï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢æˆåˆé€‚çš„æŒ‡é’ˆç±»å‹ã€‚

#### ç¤ºä¾‹ï¼š
```c++
int* p = (int*)malloc(sizeof(int));  // åˆ†é…å†…å­˜ï¼Œä½†ä¸ä¼šåˆå§‹åŒ–
*p = 42;                             // æ‰‹åŠ¨èµ‹å€¼
```

#### `free` çš„ç‰¹ç‚¹ï¼š

1. ç”¨æ¥é‡Šæ”¾ `malloc` åˆ†é…çš„å†…å­˜ã€‚
2. ä¸ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼ˆå¦‚æœæ˜¯å¯¹è±¡ï¼Œå¯èƒ½å¯¼è‡´èµ„æºæœªæ­£ç¡®é‡Šæ”¾ï¼‰ã€‚

#### ç¤ºä¾‹ï¼š

```c++
free(p);  // é‡Šæ”¾å†…å­˜
p = NULLï¼› // å¥½ä¹ æƒ¯ï¼šfree ä¹‹åï¼ŒæŒ‡é’ˆè¦èµ‹å€¼ä¸ºç©º
```

### 2.5  å¯¹è±¡çš„åŠ¨æ€å†…å­˜åˆ†é…

C++ çš„ `new` å’Œ `delete` ä¸ä»…èƒ½ç”¨æ¥ç®¡ç†åŸºæœ¬ç±»å‹çš„å†…å­˜ï¼Œè¿˜å¯ä»¥ç”¨äºå¯¹è±¡çš„åŠ¨æ€å†…å­˜åˆ†é…ã€‚ç›¸æ¯” `malloc`ï¼Œ`new` çš„ä¼˜åŠ¿åœ¨äºèƒ½è‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡ï¼Œè€Œ `delete` åˆ™ä¼šè°ƒç”¨ææ„å‡½æ•°è¿›è¡Œæ¸…ç†ã€‚

#### åŠ¨æ€åˆ†é…å•ä¸ªå¯¹è±¡

**ç¤ºä¾‹ï¼š**

```c++
class Car {
public:
    Car(const std::string& brand) : brand_(brand) {
        std::cout << "Car " << brand_ << " created.\n";
    }
    ~Car() {
        std::cout << "Car " << brand_ << " destroyed.\n";
    }
private:
    std::string brand_;
};

int main() {
    Car* myCar = new Car("Tesla");  // åŠ¨æ€åˆ†é…å¯¹è±¡
    delete myCar;                  // é”€æ¯å¯¹è±¡å¹¶é‡Šæ”¾å†…å­˜
    return 0;
}
```

**è¾“å‡ºï¼š**

```bash
Car Tesla created.
Car Tesla destroyed.
```

**è§£è¯»ï¼š**

+ `new Car()`ï¼š åˆ†é…å†…å­˜å¹¶è°ƒç”¨æ„é€ å‡½æ•°ã€‚
+ `delete myCar`ï¼š è°ƒç”¨ææ„å‡½æ•°å¹¶é‡Šæ”¾å†…å­˜ã€‚

#### åŠ¨æ€åˆ†é…å¯¹è±¡æ•°ç»„

**ç¤ºä¾‹ï¼š**

```c++
Car* cars = new Car[2] {Car("BMW"), Car("Audi")};  // åŠ¨æ€åˆ†é…å¯¹è±¡æ•°ç»„
delete[] cars;                                    // é‡Šæ”¾å†…å­˜
```

**è¾“å‡ºï¼š**

```bash
Car BMW created.
Car Audi created.
Car Audi destroyed.
Car BMW destroyed.
```

**æ³¨æ„ï¼š**

+ **æ„é€ ä¸ææ„é¡ºåºï¼š** æ„é€ æŒ‰é¡ºåºï¼Œææ„æŒ‰é€†åºæ‰§è¡Œã€‚
+ `new[]` å’Œ `delete[]` å¿…é¡»æˆå¯¹ä½¿ç”¨ã€‚

é€šè¿‡ `new` å’Œ `delete`ï¼Œä½ å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå’Œé”€æ¯å¯¹è±¡ï¼Œä½†è®°ä½æ¯æ¬¡ `new` éƒ½è¦åŠæ—¶ `delete`ï¼Œä»¥å…å‡ºç°å†…å­˜æ³„æ¼ï¼

###  2.6 `new/delete` å’Œ `malloc/free` çš„åŒºåˆ«ï¼š

| åŠŸèƒ½ | `new/delete` | `malloc/free` |
| --- | --- | --- |
| **æ˜¯å¦åˆå§‹åŒ–** | `new`<br/> ä¼šåˆå§‹åŒ–å†…å­˜ | `malloc`<br/> ä¸ä¼šåˆå§‹åŒ– |
| **æ˜¯å¦éœ€è¦ç±»å‹è½¬æ¢** | ä¸éœ€è¦ï¼Œè¿”å›å…·ä½“ç±»å‹æŒ‡é’ˆ | éœ€è¦æ‰‹åŠ¨ç±»å‹è½¬æ¢ |
| **æ˜¯å¦è°ƒç”¨æ„é€ /ææ„å‡½æ•°** | è°ƒç”¨æ„é€ å’Œææ„å‡½æ•° | ä¸ä¼šè°ƒç”¨ |
| **ä½¿ç”¨åœºæ™¯** | C++ é¢å‘å¯¹è±¡ç¼–ç¨‹ä¼˜å…ˆé€‰æ‹© | C é£æ ¼ä»£ç æˆ–ç‰¹æ®Šåœºæ™¯ä¸‹ä½¿ç”¨ |


è®°ä½ï¼Œåˆ†é…äº†å†…å­˜å°±è¦è´Ÿè´£åˆ°åº•ï¼Œ`new` å’Œ `delete` è¿™å¯¹æ­æ¡£ç”¨å¥½åï¼Œå†…å­˜æ³„æ¼çš„é—®é¢˜å°±èƒ½å¤§å¤§å‡å°‘å•¦ï¼

## 3. å¸¸è§çš„å†…å­˜é—®é¢˜ï¼šéƒ½æ˜¯è‡ªå·±æŒ–çš„å‘

`new` å’Œ `delete` æ˜¯ç®¡ç†å †å†…å­˜çš„ä¸¤ä½å¾—åŠ›â€œç®¡ç†å‘˜â€ï¼Œä½†æ­£å¦‚ç°å®ä¸­çš„ç®¡ç†ä¸€æ ·ï¼Œå·¥å…·çš„å­˜åœ¨å¹¶ä¸æ„å‘³ç€æ²¡æœ‰é—®é¢˜ã€‚ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬è¦æ—¶åˆ»ä¿æŒâ€œåˆ†é…-é‡Šæ”¾â€çš„æ¸…æ™°é€»è¾‘ï¼Œå¦åˆ™ï¼Œä¸€ä¸å°å¿ƒï¼Œå°±å¯èƒ½ç»™ç¨‹åºåŸ‹ä¸‹éšæ‚£ã€‚

å¸¸è§çš„å†…å­˜é—®é¢˜ï¼Œæ¯”å¦‚**å†…å­˜æ³„æ¼**ã€**é‡æŒ‡é’ˆ**ã€**é‡å¤é‡Šæ”¾**ï¼Œå¤§å¤šæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä½¿ç”¨ `new` å’Œ `delete` æ—¶â€œæ“ä½œå¤±è¯¯â€å¯¼è‡´çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™äº›â€œå‘â€æ˜¯æ€ä¹ˆæŒ–å‡ºæ¥çš„ï¼Œä»¥åŠå¦‚ä½•é¿å…è¸©è¿›å»ï¼

### 3.1 å†…å­˜æ³„æ¼ï¼šå€Ÿäº†ä¸œè¥¿å´å¿˜äº†è¿˜

#### åœºæ™¯ï¼š

å †å†…å­˜éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†ï¼Œç”¨ `new` åˆ†é…ï¼Œç”¨ `delete` é‡Šæ”¾ã€‚ä½†å¦‚æœä½ åˆ†é…äº†å†…å­˜å´å¿˜äº†é‡Šæ”¾ï¼Œå°±ä¼šå‘ç”Ÿ **å†…å­˜æ³„æ¼**ã€‚ å°±åƒä½ å ç”¨äº†åœè½¦ä½å´è¿Ÿè¿Ÿä¸æŒªè½¦ï¼Œå¯¼è‡´åœè½¦åœºçš„è½¦ä½è¢«å æ»¡ï¼Œå…¶ä»–äººä¹Ÿæ²¡åœ°æ–¹åœè½¦äº†ã€‚

#### ç¤ºä¾‹ï¼š
```c++
void memoryLeak() {
    int* p = new int(42);  // ä»å †é‡Œåˆ†é…ä¸€ä¸ªç©ºé—´å­˜æ”¾æ•´æ•°
    // å¿˜è®°é‡Šæ”¾ï¼ˆdelete pï¼‰ï¼Œå†…å­˜æ³„æ¼äº†
}
```

#### åæœï¼š
ç¨‹åºçš„å†…å­˜å ç”¨ä¼šä¸æ–­å¢é•¿ï¼Œå°¤å…¶åœ¨é•¿æ—¶é—´è¿è¡Œçš„åœºæ™¯ï¼ˆæ¯”å¦‚æœåŠ¡å™¨ç¨‹åºï¼‰ï¼Œå†…å­˜è¿Ÿæ—©è¢«è€—å°½ï¼Œç¨‹åºå¡æ­»ã€‚

#### æ€ä¹ˆé¿å…ï¼Ÿ

è®°ä½ **â€œå€Ÿå¤šå°‘å†…å­˜ï¼Œè¿˜å¤šå°‘**â€ï¼Œåªè¦ç”¨ `new` åˆ†é…äº†å†…å­˜ï¼Œå°±ä¸€å®šè¦ç”¨ `delete` æŠŠå®ƒé‡Šæ”¾ã€‚

```c++
void noMemoryLeak() {
    int* p = new int(42);  // åˆ†é…ç©ºé—´
    delete p;              // åŠæ—¶é‡Šæ”¾
}
```

### 3.2 æ‚¬ç©ºæŒ‡é’ˆï¼šæˆ¿å­æ‹†äº†è¿˜æƒ³ä½

**æ‚¬ç©ºæŒ‡é’ˆ** å°±æ˜¯ä½ æŠŠæˆ¿å­ï¼ˆå†…å­˜ï¼‰æ‹†äº†ï¼Œä½†é’¥åŒ™ï¼ˆæŒ‡é’ˆï¼‰è¿˜åœ¨æ‰‹ä¸Šã€‚ç»“æœä½ è¯•å›¾ç”¨è¿™æŠŠé’¥åŒ™å¼€é—¨ï¼ˆè®¿é—®å†…å­˜ï¼‰ï¼Œè¦ä¹ˆæ‰¾ä¸åˆ°é—¨ï¼Œè¦ä¹ˆç›´æ¥å‡ºäº‹æ•…ã€‚

#### ä¾‹å­ï¼š

```c++
void danglingPointer() {
    int* p = new int(10);  // å€Ÿäº†ä¸€ä¸ªæˆ¿å­
    delete p;              // æŠŠæˆ¿å­æ‹†äº†
    *p = 42;               // ç”¨é’¥åŒ™å¼€ä¸å­˜åœ¨çš„é—¨ï¼Œå´©äº†
}
```

#### é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ

ä½ ç”¨ `delete` é‡Šæ”¾äº†å†…å­˜ï¼Œä½†æŒ‡é’ˆè¿˜æŒ‡å‘é‚£å—åœ°å€ï¼Œç»“æœä½ ä¸€ä¸å°å¿ƒä¿®æ”¹å®ƒï¼Œç¨‹åºå°±å´©äº†ã€‚

#### æ€ä¹ˆé¿å…ï¼Ÿ

+ **å¥½ä¹ æƒ¯**ï¼šé‡Šæ”¾å®Œå†…å­˜åï¼ŒæŠŠæŒ‡é’ˆè®¾ç½®ä¸º `NULL`ã€‚

```c++
void noDangling() {
    int* p = new int(10);
    delete p;
    p = NULL;  // é”€æ¯æˆ¿å­ï¼ŒæŠŠé’¥åŒ™æ‰”äº†
}
```

### 3.3 é‡æŒ‡é’ˆï¼šæ²¡æˆ¿å­å´ä¹±æ‹¿é’¥åŒ™å¼€é—¨

**é‡æŒ‡é’ˆ** æ˜¯æŒ‡é’ˆå˜é‡æ²¡æœ‰åˆå§‹åŒ–ï¼Œå°±ä¹±æŒ‡å‘ä¸€å—æœªçŸ¥çš„å†…å­˜ã€‚å°±åƒä½ æ‰‹é‡Œæ‹¿äº†ä¸€æŠŠæ¥å†ä¸æ˜çš„é’¥åŒ™ï¼Œç»“æœä¸å°å¿ƒæ‰“å¼€äº†åˆ«äººçš„é—¨ï¼ˆè®¿é—®äº†éæ³•åœ°å€ï¼‰ã€‚

#### ä¾‹å­ï¼š

```c++
void wildPointer() {
    int* p;  // æ²¡ç»™åœ°å€å°±ç›´æ¥ç”¨
    *p = 10; // æ‹¿ç€é’¥åŒ™å¼€é—¨ï¼Œç›´æ¥æŠ¥é”™
}
```

#### é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ

æŒ‡é’ˆæ²¡æœ‰åˆå§‹åŒ–ï¼Œä½†ä½ å´ä½¿ç”¨å®ƒï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–è€…è®¿é—®éæ³•æ•°æ®ã€‚

#### æ€ä¹ˆé¿å…ï¼Ÿ

â€œæœªåˆå§‹åŒ–æŒ‡é’ˆä¸èƒ½ä¹±è·‘â€ï¼šå£°æ˜æŒ‡é’ˆæ—¶è¦ä¹ˆèµ‹å€¼( ç»™å®ƒåˆ†é…åœ°å€ )ï¼Œè¦ä¹ˆåˆå§‹åŒ–ä¸º `NULL`ã€‚

```c++
void noWildPointer() {
    int* p = new int(10);  // å…ˆèµ‹å€¼ï¼Œå†ä½¿ç”¨
    if (p) {
        *p = 20;       // å…ˆæ£€æŸ¥æŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆå†æ“ä½œ
    }
}
```

### 3.4 åŒé‡é‡Šæ”¾ï¼š åå¤é€€è¿˜å·²ç»é€€æ‰çš„æˆ¿é—´

#### åœºæ™¯ï¼š

åŒé‡é‡Šæ”¾æ˜¯æŒ‡ï¼Œä½ é‡Šæ”¾äº†ä¸€å—å†…å­˜ï¼ˆç”¨ `delete`ï¼‰ï¼Œå´åˆå¯¹åŒä¸€ä¸ªæŒ‡é’ˆå†æ¬¡é‡Šæ”¾ã€‚è¿™å°±åƒä½ å·²ç»é€€æ‰äº†ä¸€é—´æˆ¿ï¼ˆæˆ¿é—´å·²ç»è¢«æ³¨é”€äº†ï¼‰ï¼Œä½†ä½ å´æ‹¿ç€å·²ç»æ³¨é”€çš„æˆ¿å¡è·‘å»å‰å°è¯´ï¼šâ€œå†é€€ä¸€æ¬¡ã€‚â€ å‰å°ä¸çŸ¥æ‰€æªï¼šæˆ¿é—´éƒ½æ²¡äº†ï¼Œä½ é€€ä»€ä¹ˆé€€â€ï¼Œæ˜¯æƒ³æäº‹å—ï¼Ÿ 

#### ç¤ºä¾‹ï¼š

```c++
void doubleDelete() {
    int* p = new int(42);  // åœ¨å †ä¸Šåˆ†é…äº†ä¸€é—´æˆ¿
    delete p;              // ç¬¬ä¸€æ¬¡é€€æˆ¿ï¼ˆé‡Šæ”¾å†…å­˜ï¼‰
    delete p;              // å†æ¬¡é€€æˆ¿ï¼Œç³»ç»Ÿå´©æºƒï¼
}
```

#### é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ
- ç¬¬ä¸€æ¬¡ deleteï¼šæˆ‘ä»¬æˆåŠŸé‡Šæ”¾äº†å†…å­˜ï¼ŒæŠŠæˆ¿é—´ï¼ˆå†…å­˜ï¼‰è¿˜ç»™äº†ç³»ç»Ÿã€‚æŒ‡é’ˆ p è¿˜æŒ‡å‘åŸæ¥é‚£ä¸ªå†…å­˜åœ°å€ã€‚

- ç¬¬äºŒæ¬¡ deleteï¼šæŒ‡é’ˆ p ä»ç„¶æŒ‡å‘å·²ç»è¢«é‡Šæ”¾çš„å†…å­˜ä½ç½®ã€‚ç³»ç»Ÿå‘ç°ä½ è¦å†æŠŠä¸€ä¸ªå·²ç»â€œè¿˜æ‰çš„æˆ¿é—´â€é€€ä¸€éï¼Œå°±å´©æºƒäº†ã€‚è¿™ç§ç°è±¡å«åšâ€œé‡æŒ‡é’ˆâ€â€”â€”æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å·²ç»æ²¡æœ‰äº†ï¼Œä½†æŒ‡é’ˆä¾ç„¶åœ¨ï¼Œå†è®¿é—®æˆ–è€…é‡Šæ”¾å®ƒå°±ä¼šå‡ºé—®é¢˜ã€‚

#### åæœï¼š

- **ç¨‹åºå´©æºƒï¼š** ç³»ç»Ÿä¸çŸ¥é“å¦‚ä½•å¤„ç†é‡å¤é‡Šæ”¾çš„å†…å­˜ï¼Œåªèƒ½ç»ˆæ­¢ç¨‹åºã€‚

#### æ€ä¹ˆé¿å…ï¼Ÿ

**åŸåˆ™ï¼šé€€æˆ¿åæ³¨é”€æˆ¿å¡ï¼**

é‡Šæ”¾å†…å­˜åï¼ŒæŒ‡é’ˆå°±åƒæˆ¿å¡ï¼Œå®ƒä»ç„¶æŒ‡å‘åŸæ¥çš„åœ°å€ï¼ˆå³ä½¿å†…å­˜å·²ç»é‡Šæ”¾ï¼‰ã€‚ä¸ºäº†é¿å…è¯¯æ“ä½œï¼Œé‡Šæ”¾å†…å­˜åï¼Œç«‹å³å°†æŒ‡é’ˆè®¾ç½®ä¸º `NULL`ï¼Œè¡¨ç¤ºè¿™å¼ æˆ¿å¡å·²ç»æ³¨é”€ï¼Œä¸èƒ½å†ä½¿ç”¨ã€‚

#### æ”¹è¿›åçš„ä»£ç ï¼š
```c++
void noDoubleDelete() {
    int* p = new int(42);  // ä»å †é‡Œå€Ÿäº†ä¸€é—´æˆ¿
    delete p;              // ç¬¬ä¸€æ¬¡é€€æˆ¿ï¼Œé‡Šæ”¾å†…å­˜
    p = NULL;           // æ³¨é”€æˆ¿å¡ï¼Œé˜²æ­¢å†æ¬¡ä½¿ç”¨
}
```

#### è§£é‡Šï¼š
+ `p = NULL;` æ„å‘³ç€æŒ‡é’ˆä¸å†æŒ‡å‘ä»»ä½•æœ‰æ•ˆçš„å†…å­˜ï¼Œå˜æˆäº†ç©ºæŒ‡é’ˆã€‚
+ å†æ¬¡å°è¯• `delete p` æ—¶ï¼Œ`NULL` ä¸ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå› ä¸ºç³»ç»ŸçŸ¥é“è¿™æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆã€‚

### 3.5 æ ˆæº¢å‡ºï¼šå¿«é€’æŸœå¡ä¸ä¸‹å¤§ä»¶
#### åœºæ™¯ï¼š

æ ˆåŒºç©ºé—´å¾ˆå°ï¼Œä¸€èˆ¬åªæœ‰å‡  MBã€‚å¦‚æœä½ åœ¨æ ˆé‡Œå­˜äº†ä¸€ä¸ªè¶…å¤§çš„æ•°ç»„ï¼Œæˆ–è€…é€’å½’è°ƒç”¨å‡½æ•°æ¬¡æ•°å¤ªå¤šï¼Œå°±ä¼šå¯¼è‡´ **æ ˆæº¢å‡º**ã€‚è¿™å°±åƒå¿«é€’æŸœåªèƒ½æ”¾å°åŒ…è£¹ï¼Œä½†ä½ éè¦å¡ä¸ªå†°ç®±è¿›å»ï¼ŒæŸœé—¨ç›´æ¥è¢«æ’‘çˆ†ã€‚ 

#### ç¤ºä¾‹ï¼š
```c++
void stackOverflow() {
    int arr[1000000];  // æ ˆåŒºå­˜æ”¾ä¸€ä¸ªå·¨å¤§çš„æ•°ç»„
}
```

#### åæœï¼š
ç¨‹åºç›´æ¥å´©æºƒï¼ŒæŠ¥ â€œSegmentation Faultâ€ã€‚

#### æ€ä¹ˆé¿å…ï¼Ÿ
æŠŠå¤§æ•°æ®æ”¾åˆ°å †é‡Œï¼Œå› ä¸ºå †çš„ç©ºé—´æ›´å¤§ã€æ›´çµæ´»ã€‚

```c++
void noStackOverflow() {
    int* arr = new int[1000000];  // æŠŠå¤§æ•°æ®å­˜åˆ°å †é‡Œ
    delete[] arr;                 // åˆ«å¿˜äº†é‡Šæ”¾å†…å­˜
}
```

### 3.6 å†…å­˜è¶Šç•Œï¼šç”¨é”™é’¥åŒ™å¼€é”™é—¨

#### åœºæ™¯ï¼š
å†…å­˜è¶Šç•Œå°±åƒä½ ä½åœ¨ä¸€æ ‹å…¬å¯“é‡Œï¼Œé—¨ç‰Œå·ä» `0` åˆ° `4`çš„æˆ¿é—´å±äºä½ ï¼Œä½†æ˜¯ä½ ååæ‹¿ç€é’¥åŒ™å»è¯•å¼€ `5` å·æˆ¿çš„é—¨ã€‚è¿™ä¸ªæˆ¿é—´æ ¹æœ¬ä¸æ˜¯ä½ çš„ï¼Œè½»åˆ™æ‰“ä¸å¼€ï¼Œé‡åˆ™é—¯å…¥é‚»å±…å®¶ï¼Œå¼•å‘ä¸€åœºå°´å°¬æˆ–æ··ä¹±ã€‚

#### ç¤ºä¾‹ï¼š
```c++
void memoryOverflow() {
    int arr[5] = {1, 2, 3, 4, 5};  // é—¨ç‰Œå·æ˜¯ 0 åˆ° 4
    arr[5] = 10;                   // è¶Šç•Œè®¿é—®ï¼Œè¯•å›¾å¼€ä¸å­˜åœ¨çš„ 5 å·æˆ¿
}
```

#### é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ
+ æ•°ç»„ä¸‹æ ‡ä» `0` å¼€å§‹ï¼Œåˆæ³•èŒƒå›´æ˜¯ `arr[0]` åˆ° `arr[4]`ã€‚
+ è¯•å›¾è®¿é—® `arr[5]`ï¼Œå·²ç»è¶…å‡ºäº†æ•°ç»„çš„èŒƒå›´ï¼Œå°±ç›¸å½“äºç”¨é’¥åŒ™å»è¯•æ¢ä¸å±äºä½ çš„æˆ¿é—´ã€‚

#### åæœï¼š
**è¯¯ä¼¤é‚»å±…ï¼ˆç ´åæ•°æ®ï¼‰ï¼š** å¦‚æœ 5 å·æˆ¿é‡Œæœ‰åˆ«çš„é‚»å±…çš„ä¸œè¥¿ï¼ˆå…¶ä»–å†…å­˜åŒºåŸŸçš„æ•°æ®ï¼‰ï¼Œä½ çš„æ“ä½œå¯èƒ½ä¼šè¯¯ä¿®æ”¹è¿™äº›æ•°æ®ã€‚

#### æ€ä¹ˆé¿å…ï¼Ÿ

**åŸåˆ™ï¼šç”¨é’¥åŒ™å‰ï¼Œå…ˆç¡®è®¤é—¨ç‰Œå·ï¼**

æ”¹è¿›åçš„ä»£ç ï¼š

**1. æ‰‹åŠ¨æ£€æŸ¥è¾¹ç•Œï¼š**  

åœ¨è®¿é—®æ•°ç»„æ—¶ï¼Œç¡®ä¿ä¸‹æ ‡åœ¨åˆæ³•èŒƒå›´å†…ï¼Œåˆ«æ‹¿é’¥åŒ™ä¹±å¼€é—¨ã€‚

```c++
void noMemoryOverflow() {
    int arr[5] = {1, 2, 3, 4, 5};
    int index = 5;

    if (index >= 0 && index < 5) {  // æ£€æŸ¥é—¨ç‰Œå·æ˜¯å¦åˆæ³•
        arr[index] = 10;           // å®‰å…¨æ“ä½œ
    } else {
        std::cout << "Invalid room number!" << std::endl;
    }
}
```

**2. ç”¨æ™ºèƒ½å®¹å™¨ä¿æŠ¤è‡ªå·±ï¼š**  

ä½¿ç”¨ `std::vector`ï¼Œç”¨ `at()` æ–¹æ³•è®¿é—®å…ƒç´ ã€‚å¦‚æœè¶Šç•Œï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå°±åƒå‘Šè¯‰ä½ ï¼š**â€œåˆ«ä¹±å¼€é—¨ï¼â€**

```c++
#include <vector>
void noMemoryOverflowWithVector() {
    std::vector<int> arr = {1, 2, 3, 4, 5};
    try {
        arr.at(5) = 10;  // æŠ›å‡ºå¼‚å¸¸ï¼Œæç¤ºä½ é—¨ç‰Œå·ä¸å¯¹
    } catch (const std::out_of_range& e) {
        std::cerr << "Error: " << e.what() << std::endl;
    }
}
```

**3. ç”¨æ›´å®‰å…¨çš„å·¡é€»æ–¹å¼ï¼š**  

å¦‚æœä½ åªæ˜¯æƒ³éå†æ•´ä¸ªæ•°ç»„ï¼Œä¸å¦¨ç”¨ `for` å¾ªç¯æˆ–è¿­ä»£å™¨ï¼Œä¸ç›´æ¥æ“ä½œä¸‹æ ‡ï¼Œé¿å…ç”¨é”™é’¥åŒ™ã€‚

```c++
#include <vector>
void safeIteration() {
    std::vector<int> arr = {1, 2, 3, 4, 5};
    for (int i = 0;i<arr.size();++i) {  // éå†åˆæ³•æˆ¿é—´
        std::cout << arr[i] << std::endl;
    }
}
```

### 3.7 æœªåˆå§‹åŒ–çš„å˜é‡ï¼šç©ºç®±å­å½“æˆæ»¡çš„ç”¨

#### åœºæ™¯ï¼š
æœªåˆå§‹åŒ–çš„å˜é‡ä¼šä¿å­˜éšæœºå€¼ï¼ˆåœ¨å †æˆ–æ ˆä¸­ï¼‰ï¼Œå¦‚æœä½ ç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¼•å‘æ„å¤–çš„é”™è¯¯ã€‚å°±åƒä½ ä¹°äº†ä¸ªç©ºç®±å­ï¼Œä½†æ²¡æ£€æŸ¥å°±ç›´æ¥ç”¨å®ƒè£…ä¸œè¥¿ï¼Œç»“æœå‘ç°ç®±å­é‡Œå…¶å®æœ‰â€œåƒåœ¾â€ã€‚

#### ç¤ºä¾‹ï¼š
```c++
void uninitializedVariable() {
    int x;         // å£°æ˜äº†å˜é‡ï¼Œä½†æ²¡åˆå§‹åŒ–
    std::cout << x << std::endl;  // è¾“å‡ºéšæœºå€¼
}
```

#### åæœï¼š
+  å˜é‡å£°æ˜åä¼šå ç”¨å†…å­˜ï¼Œä½†å¦‚æœæ²¡åˆå§‹åŒ–ï¼Œè¿™å—å†…å­˜é‡Œå¯èƒ½æœ‰â€œåƒåœ¾æ•°æ®â€ï¼ˆéšæœºå€¼ï¼‰ã€‚ç¨‹åºç›´æ¥è®¿é—®è¿™äº›éšæœºå€¼ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚

#### æ€ä¹ˆé¿å…ï¼Ÿ
+ å§‹ç»ˆåˆå§‹åŒ–å˜é‡ï¼Œæˆ–è€…ä½¿ç”¨ C++ çš„é»˜è®¤å€¼è¯­æ³•ï¼š

```c++
void noUninitializedVariable() {
    int x = 0;  // æ˜ç¡®åˆå§‹åŒ–
    std::cout << x;
}
```

### 3.8 æŒ‡é’ˆä¼ é€’é”™è¯¯ï¼šå¼„é”™äº†åœ°å€çš„å½’å±
#### åœºæ™¯ï¼š
åœ¨å‡½æ•°å‚æ•°ä¸­ï¼Œé”™è¯¯åœ°ä¼ é€’äº†æ ˆä¸Šå˜é‡çš„åœ°å€æˆ–è€…å±€éƒ¨å˜é‡çš„æŒ‡é’ˆï¼Œå¯¼è‡´å‡½æ•°è¿”å›åæŒ‡é’ˆå˜æˆæ‚¬ç©ºæŒ‡é’ˆã€‚

#### ç¤ºä¾‹ï¼š
```c++
int* returnDanglingPointer() {
    int x = 42;  // æ ˆä¸Šçš„å±€éƒ¨å˜é‡
    return &x;   // è¿”å›å±€éƒ¨å˜é‡çš„åœ°å€
}
```

#### åæœï¼š
+ è°ƒç”¨å‡½æ•°åï¼Œè¿”å›çš„æŒ‡é’ˆæŒ‡å‘æ— æ•ˆå†…å­˜ï¼Œè®¿é—®æ—¶ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚

#### æ€ä¹ˆé¿å…ï¼Ÿ
+ é¿å…è¿”å›å±€éƒ¨å˜é‡çš„åœ°å€ã€‚
+ å¦‚æœéœ€è¦è·¨å‡½æ•°ä½¿ç”¨å†…å­˜ï¼Œå¯ä»¥åœ¨å †ä¸Šåˆ†é…ï¼š

```c++
int* safePointer() {
    int* x = new int(42);  // å †ä¸Šåˆ†é…å†…å­˜
    return x;
}
```

## 4. å¦‚ä½•é«˜æ•ˆæ£€æŸ¥å†…å­˜é—®é¢˜ï¼Ÿ
åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬åˆ—ä¸¾äº† C++ å¼€å‘ä¸­å¸¸è§çš„å†…å­˜é—®é¢˜ï¼Œæ¯”å¦‚å†…å­˜æ³„æ¼ã€æ‚¬ç©ºæŒ‡é’ˆã€æ ˆæº¢å‡ºç­‰ç­‰ã€‚å¬èµ·æ¥åƒæ˜¯åœ¨åœ°é›·é˜µé‡Œå†™ä»£ç ï¼Œæ¯èµ°ä¸€æ­¥éƒ½å¯èƒ½è¸©å‘ã€‚è¿™äº›é—®é¢˜ï¼Œè½»åˆ™é€»è¾‘é”™è¯¯ï¼Œé‡åˆ™ç¨‹åºå´©æºƒï¼Œç”šè‡³å¸¦æ¥å®‰å…¨éšæ‚£ã€‚

**ä½ å¯èƒ½ä¼šé—®**ï¼š

â€œè¿™äº›å‘éƒ½çŸ¥é“äº†ï¼Œå¯çœŸè¸©ä¸Šäº†ï¼Œæ€ä¹ˆæŸ¥é—®é¢˜å‘¢ï¼Ÿâ€  

åˆ«æ‹…å¿ƒï¼C++ ä¸åªæ˜¯å‘å¤šï¼Œå®ƒçš„è°ƒè¯•å·¥å…·ä¹Ÿå¾ˆå¼ºå¤§ã€‚æ— è®ºæ˜¯å†…å­˜æ³„æ¼ã€è¶Šç•Œè®¿é—®ï¼Œè¿˜æ˜¯å…¶ä»–éšè”½é—®é¢˜ï¼Œéƒ½æœ‰ä¸€å¥—æˆç†Ÿçš„æ–¹æ³•å’Œå·¥å…·ï¼Œå¸®ä½ æ‰¾åˆ°â€œç½ªé­ç¥¸é¦–â€ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œå¦‚ä½•å¿«é€Ÿå®šä½è¿™äº›å†…å­˜é—®é¢˜ï¼Œè®©ä½ çš„ä»£ç è¿œç¦»â€œå†…å­˜åœ°ç‹±â€ã€‚

### 4.1 ç”¨è‚‰çœ¼æ£€æŸ¥ï¼šé æ—¥å¿—æ’é›·

#### æ–¹æ³•ï¼š

åœ¨æ¯æ¬¡ `new` å’Œ `delete` çš„åœ°æ–¹åŠ ä¸Šæ—¥å¿—ï¼Œè®°å½•å†…å­˜åˆ†é…å’Œé‡Šæ”¾æƒ…å†µã€‚

#### ç¤ºä¾‹ï¼š

```c++
#include <iostream>

void example() {
    int* p = new int(42);
    std::cout << "Allocated memory at address: " << p << std::endl;

    delete p;
    std::cout << "Released memory at address: " << p << std::endl;
}
```

#### å¥½å¤„ï¼š
1. èƒ½ç›´è§‚åœ°çœ‹å‡ºå“ªäº›å†…å­˜åˆ†é…äº†ä½†æ²¡é‡Šæ”¾ã€‚
2. é€‚åˆæ’æŸ¥ç®€å•çš„å†…å­˜æ³„æ¼ã€‚

#### å±€é™ï¼š

å¦‚æœå†…å­˜æ“ä½œéå¸¸å¤šï¼Œæ—¥å¿—ä¼šæ˜¾å¾—ç¹çï¼Œæ•ˆç‡ä½ã€‚

### 4.2 ç”¨å·¥å…·æ£€æµ‹ï¼šæ•ˆç‡å‡çº§

#### å·¥å…· 1ï¼šValgrind

å¦‚æœä½ åœ¨ Linux ä¸Šå¼€å‘ï¼Œ**Valgrind** æ˜¯æŸ¥å†…å­˜é—®é¢˜çš„å¿…å¤‡å·¥å…·ã€‚å®ƒå¯ä»¥å¸®ä½ ï¼š

+ æ£€æµ‹å†…å­˜æ³„æ¼ã€‚
+ æ‰¾åˆ°æ— æ•ˆçš„å†…å­˜è®¿é—®ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
valgrind --tool=memcheck --leak-check=full ./your_program
```

**é€‰é¡¹**ï¼š

+ `--tool=memcheck` : æŒ‡å®šä½¿ç”¨ memcheck å·¥å…·ï¼Œè¿™æ˜¯ Valgrind çš„é»˜è®¤å·¥å…·ï¼Œç”¨äºæ£€æµ‹å†…å­˜ç®¡ç†ç›¸å…³é—®é¢˜ï¼ŒåŒ…æ‹¬å†…å­˜æ³„æ¼ã€éæ³•å†…å­˜è®¿é—®ã€æœªåˆå§‹åŒ–å˜é‡ç­‰ã€‚
+ `--leak-check=full`  : å¯ç”¨è¯¦ç»†çš„å†…å­˜æ³„æ¼æ£€æŸ¥ã€‚full æ¨¡å¼ä¼šè¾“å‡ºæ‰€æœ‰æ³„æ¼çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³„æ¼çš„å¤§å°ã€ä½ç½®å’Œæ ˆè¿½è¸ªä¿¡æ¯ã€‚

**ç¤ºä¾‹ï¼š**

å‡è®¾ä½ çš„ä»£ç æœ‰å†…å­˜æ³„æ¼ï¼š

```c++
void leakExample() {
    int* p = new int[10];  // åˆ†é…å†…å­˜ä½†å¿˜è®°é‡Šæ”¾
}
```
è¿è¡Œ Valgrindï¼š

```bash
valgrind --tool=memcheck --leak-check=full ./a.out
```

è¾“å‡ºï¼š

```csharp
==12345== 40 bytes in 1 blocks are definitely lost in loss record 1 of 1
==12345==    at 0x4C2E1B2: operator new[](unsigned long) (vg_replace_malloc.c:431)
==12345==    by 0x4011E7: leakExample() (example.cpp:2)
```

**ä¼˜ç‚¹ï¼š**

1. è‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼ï¼Œçœå»æ‰‹åŠ¨æ’æŸ¥çš„éº»çƒ¦ã€‚
2. è¾“å‡ºè¯¦ç»†çš„æ³„æ¼ä¿¡æ¯ï¼Œå‘Šè¯‰ä½ æ³„æ¼å‘ç”Ÿçš„ä½ç½®ã€‚

#### å·¥å…· 2ï¼šAddressSanitizer (ASan) Valgrind

**ASan** æ˜¯ GCC å’Œ Clang æä¾›çš„å†…å­˜é—®é¢˜æ£€æµ‹å·¥å…·ï¼Œè½»é‡é«˜æ•ˆï¼Œç‰¹åˆ«é€‚åˆæŸ¥æ‰¾å†…å­˜è¶Šç•Œå’Œæ— æ•ˆå†…å­˜è®¿é—®é—®é¢˜ã€‚

#### ä½¿ç”¨æ–¹æ³•ï¼š

åœ¨ç¼–è¯‘æ—¶åŠ ä¸Š `-fsanitize=address` é€‰é¡¹ï¼š

```bash
g++ -fsanitize=address -g your_program.cpp -o your_program
./your_program
```

**é€‰é¡¹**ï¼š

+ `-fsanitize=address`ï¼šå¯ç”¨ AddressSanitizerï¼Œç”¨äºæ£€æµ‹å†…å­˜é”™è¯¯ï¼Œå¦‚è¶Šç•Œè®¿é—®ã€éæ³•é‡Šæ”¾ç­‰ã€‚
+ `-g`ï¼šç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•æ—¶æ˜¾ç¤ºå…·ä½“ä»£ç ä½ç½®å’Œè¡Œå·ã€‚

#### ç¤ºä¾‹ï¼š
å‡è®¾ä»£ç æœ‰å†…å­˜è¶Šç•Œé—®é¢˜ï¼š

```c++
void bufferOverflow() {
    int arr[5] = {0};
    arr[5] = 10;  // è¶Šç•Œè®¿é—®
}
```

è¿è¡Œç¨‹åºåï¼ŒASan ä¼šæŠ¥é”™ï¼š

```arduino
AddressSanitizer: stack-buffer-overflow on address 0x7ffc12345678 at pc 0x401234
READ of size 4 at 0x7ffc12345678
  #2 0x7fdf8f2e3f3d in bufferOverflow /path/to/your_program.cpp:6
  #3 0x7fdf8f2e3e39 in main /path/to/your_program.cpp:10
  #4 0x7fdf8f2e3db9 in _start
```

#### ä¼˜ç‚¹ï¼š
1. ä¸ä»…å¯ä»¥æ£€æµ‹å†…å­˜æ³„æ¼ï¼Œè¿˜èƒ½æ•è·è¶Šç•Œè®¿é—®å’Œæ‚¬ç©ºæŒ‡é’ˆã€‚
2. é›†æˆç®€å•ï¼Œç¼–è¯‘æ—¶åŠ ä¸€ä¸ªé€‰é¡¹å³å¯ã€‚

### 4.3 é™æ€ä»£ç åˆ†æå·¥å…·ï¼šäº‹å‰é¢„é˜²

ä¸ Valgrind å’Œ ASan ä¸åŒï¼Œé™æ€ä»£ç åˆ†æå·¥å…·åœ¨ **ä»£ç ç¼–è¯‘ä¹‹å‰** å°±å¯ä»¥æ•è·æ½œåœ¨é—®é¢˜ï¼Œå¸®ä½ â€œé˜²æ‚£äºæœªç„¶â€ã€‚è¿™äº›å·¥å…·é€šè¿‡åˆ†æä»£ç é€»è¾‘å‘ç°é—®é¢˜ï¼Œæ— éœ€è¿è¡Œç¨‹åºï¼Œæ˜¯å¼€å‘é˜¶æ®µæå‡ä»£ç è´¨é‡çš„åˆ©å™¨ã€‚

#### å·¥å…· 1ï¼šClang-Tidy 

Clang-Tidy æ˜¯ä¸€ä¸ªè½»é‡çº§çš„é™æ€åˆ†æå·¥å…·ï¼Œä¸“ä¸º C++ è®¾è®¡ï¼Œç‰¹åˆ«æ“…é•¿å‘ç°æ½œåœ¨çš„ä»£ç é—®é¢˜ï¼Œå¹¶æå‡ºç°ä»£ C++ æ”¹è¿›å»ºè®®ã€‚

**åŠŸèƒ½ï¼š**

**1.æ£€æµ‹å†…å­˜é—®é¢˜ï¼š**  

- æ¯”å¦‚æœªåˆå§‹åŒ–çš„å˜é‡ã€æœªé‡Šæ”¾çš„æŒ‡é’ˆã€‚

**2.æé«˜ä»£ç è´¨é‡ï¼š**  
- å»ºè®®ç”¨ `nullptr` æ›¿ä»£ `NULL`ï¼Œæˆ–è€…ç”¨ç°ä»£ C++ çš„ `std::unique_ptr` æ›¿ä»£è£¸æŒ‡é’ˆã€‚

**3.ä¼˜åŒ–æ€§èƒ½ï¼š**  
- æ£€æŸ¥å¾ªç¯æ˜¯å¦å¯ä»¥ä¼˜åŒ–ï¼Œæˆ–è€…æ˜¯å¦å­˜åœ¨ä¸å¿…è¦çš„æ‹·è´ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
clang-tidy your_program.cpp --checks="*" -- -std=c++11
```

+ `--checks="*"`ï¼š å¯ç”¨æ‰€æœ‰æ£€æŸ¥è§„åˆ™ã€‚
+ `-- -std=c++11`ï¼š å‘Šè¯‰ Clang-Tidy æŒ‰ C++11 æ ‡å‡†è§£æä»£ç ã€‚

**ç¤ºä¾‹ï¼š**

å‡è®¾ä½ å¿˜äº†åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ï¼š

```c++
void uninitializedExample() {
    int x;         // æ²¡æœ‰åˆå§‹åŒ–
    std::cout << x; // ä½¿ç”¨æœªåˆå§‹åŒ–å˜é‡
}
```

è¿è¡Œ Clang-Tidyï¼Œè¾“å‡ºï¼š

```csharp
warning: variable 'x' is used uninitialized whenever 'uninitializedExample' is called [clang-analyzer-core.uninitialized.Assign]
```

**ä¼˜ç‚¹ï¼š**

1. èƒ½æ£€æŸ¥æ½œåœ¨é—®é¢˜ï¼Œè¿˜ä¼šæå‡ºæ”¹è¿›å»ºè®®ã€‚
2. æ”¯æŒè‡ªåŠ¨ä¿®å¤ï¼Œæ¯”å¦‚å‡çº§åˆ°ç°ä»£ C++ æ ‡å‡†ã€‚

**å±€é™ï¼š**

1. éœ€è¦æ­£ç¡®é…ç½®ç¼–è¯‘é€‰é¡¹ï¼ˆå¦‚å¤´æ–‡ä»¶è·¯å¾„ï¼‰ã€‚
2. éƒ¨åˆ†æ£€æŸ¥è§„åˆ™å¯èƒ½ä¸å›¢é˜Ÿä»£ç é£æ ¼ä¸ä¸€è‡´ã€‚

#### **å·¥å…· 2ï¼šCppcheck**
Cppcheck æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„é™æ€åˆ†æå·¥å…·ï¼Œä¸“æ³¨äºå‘ç° C å’Œ C++ ä»£ç ä¸­çš„é€»è¾‘é”™è¯¯å’Œå†…å­˜é—®é¢˜ã€‚ç›¸æ¯” Clang-Tidyï¼Œå®ƒçš„å®šä½æ›´å¹¿æ³›ï¼Œä¹Ÿé€‚åˆéç°ä»£ C++ é¡¹ç›®ã€‚

**åŠŸèƒ½ï¼š**

**1.æ£€æµ‹å†…å­˜é—®é¢˜ï¼š** 
- æ¯”å¦‚æ•°ç»„è¶Šç•Œã€æœªåˆå§‹åŒ–å˜é‡ã€æ‚¬ç©ºæŒ‡é’ˆã€‚

**2.å‘ç°é€»è¾‘é”™è¯¯ï¼š**  
- æ¯”å¦‚æœªä½¿ç”¨çš„å˜é‡ã€å¤šä½™çš„æ¡ä»¶åˆ¤æ–­ã€‚

**3.ä»£ç æ¸…ç†å»ºè®®ï¼š**  
- åˆ é™¤å†—ä½™ä»£ç ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cppcheck your_program.cpp
```

**ç¤ºä¾‹ï¼š**

å‡è®¾ä½ å†™äº†ä¸€ä¸ªæ•°ç»„è¶Šç•Œçš„ä»£ç ï¼š

```c++
void arrayOutOfBounds() {
    int arr[5] = {1, 2, 3, 4, 5};
    arr[5] = 10; // è¶Šç•Œè®¿é—®
}
```

è¿è¡Œ Cppcheckï¼Œè¾“å‡ºï¼š

```vbnet
warning: Array 'arr[5]' accessed at index 5, which is out of bounds.
```

**ä¼˜ç‚¹ï¼š**

1. ä¸ä¾èµ–ç¼–è¯‘å™¨é€‰é¡¹ï¼Œç®€å•æ˜“ç”¨ã€‚
2. æŠ¥å‘Šè¯¦ç»†ï¼Œé€‚åˆå¿«é€Ÿæ£€æŸ¥è€æ—§ä»£ç ã€‚

**å±€é™ï¼š**

1. æ— æ³•ç›´æ¥å»ºè®®ç°ä»£åŒ–æ”¹è¿›ï¼ˆå¦‚å‡çº§åˆ° C++11ï¼‰ã€‚
2. è§„åˆ™é›†ç›¸å¯¹æœ‰é™ï¼Œéœ€è¦æ­é…å…¶ä»–å·¥å…·ä½¿ç”¨ã€‚

### æ€»ç»“ï¼š

é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ï¼Œæˆ‘ä»¬ä»å†…å­˜çš„åˆ†å±‚ç»“æ„ï¼Œåˆ° `new` å’Œ `delete` çš„ä½¿ç”¨ï¼Œå†åˆ°å¸¸è§çš„å†…å­˜é—®é¢˜åŠå…¶æ’æŸ¥ï¼Œå…¨é¢äº†è§£äº† C++ å†…å­˜ç®¡ç†çš„æ–¹æ–¹é¢é¢ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒC++ ç»™äº†ç¨‹åºå‘˜æ›´å¤§çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ›´å¤šè´£ä»»ã€‚å¦‚æœä¸å°å¿ƒï¼Œå†…å­˜æ³„æ¼ã€æ‚¬ç©ºæŒ‡é’ˆã€æ ˆæº¢å‡ºç­‰é—®é¢˜å¾ˆå®¹æ˜“æˆä¸ºç¨‹åºçš„â€œå®šæ—¶ç‚¸å¼¹â€ã€‚

ä½†ä¸ç”¨æ€•ï¼Œå­¦ä¹ äº†è¿™äº›æ¦‚å¿µï¼Œä½ å·²ç»æŒæ¡äº†æ’é›·çš„åŸºç¡€èƒ½åŠ›ï¼æœªæ¥ï¼Œåªè¦è®°ä½è¿™äº›å…³é”®ç‚¹ï¼Œåˆç†ä½¿ç”¨ `new` å’Œ `delete`ï¼Œå¹¶å–„ç”¨æ£€æµ‹å·¥å…·ï¼Œå°±å¯ä»¥å¤§å¤§é™ä½å†…å­˜é—®é¢˜çš„é£é™©ã€‚

### ä¸‹ç¯‡é¢„å‘Šï¼šRAIIâ€”â€” C++ èµ„æºç®¡ç†çš„å…¨èƒ½é€‰æ‰‹  

å°½ç®¡æ‰‹åŠ¨ç®¡ç†å†…å­˜æ˜¯ C++ çš„ä¸€å¤§ç‰¹æ€§ï¼Œä½†æ€»æ˜¯è®°ä½ `new` å’Œ `delete` ä¹Ÿæœªå…å¤ªéº»çƒ¦äº†ï¼æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ï¼Œæ—¢èƒ½é«˜æ•ˆç®¡ç†å†…å­˜ï¼Œåˆèƒ½å‡å°‘å‡ºé”™çš„å¯èƒ½æ€§ï¼Ÿç­”æ¡ˆå°±æ˜¯ **RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰**ã€‚

RAII æ˜¯ C++ çš„ä¸€é¡¹å¼ºå¤§æ€æƒ³ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œé¿å…å¿˜è®°é‡Šæ”¾èµ„æºçš„é—®é¢˜ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å¸¦ä½ è¯¦ç»†äº†è§£ RAII çš„åŸç†ï¼Œä»¥åŠå¦‚ä½•ç”¨å®ƒæ¥å†™å‡ºæ›´å®‰å…¨ã€æ›´ä¼˜é›…çš„ä»£ç ã€‚

### æœ€å

å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œåˆ«å¿˜äº†ç‚¹ä¸ªã€Œèµã€ã€ç‚¹ä¸ªã€Œåœ¨çœ‹ã€ï¼Œæˆ–åˆ†äº«ç»™æ›´å¤šå¯¹ C++ å†…å­˜ç®¡ç†æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼å…³æ³¨å…¬ä¼—å·ã€Œè·Ÿç€å°åº·å­¦ç¼–ç¨‹ã€ï¼Œä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†æ­å¼€ RAII çš„ç¥ç§˜é¢çº±ï¼Œå¸¦ä½ ä½“éªŒæ›´åŠ å®‰å…¨ä¼˜é›…çš„ C++ ç¼–ç¨‹æ–¹å¼ï¼  


## ğŸš€ è·Ÿæˆ‘å­¦ï¼Œä½ èƒ½æ”¶è·å•¥ï¼Ÿ
åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥å­¦åˆ°ï¼š

+ Linuxã€C/C++ã€Go çš„å®æˆ˜æŠ€å·§
+ è®¡ç®—æœºåŸºç¡€çŸ¥è¯†æ¢³ç†
+ ç¼–ç¨‹é¢è¯•å¹²è´§ã€ç®—æ³•å¥—è·¯å’Œä¼˜åŒ–æ€è·¯

å†…å®¹**æ·±å…¥æµ…å‡ºã€å®ç”¨æœ‰è¶£**ï¼Œä¸å†è®©ä½ çœ‹ç€ä¹¦å°±çŠ¯å›°ã€‚  
æ— è®ºæ˜¯é¢è¯•å†²åˆºï¼Œè¿˜æ˜¯æƒ³å‡çº§æŠ€èƒ½ï¼Œè¿™é‡Œéƒ½æ˜¯ä½ çš„â€œæŠ€æœ¯åŠ æ²¹ç«™â€ã€‚


## ğŸ‘€ æƒ³åŠ å…¥ï¼Ÿå¾ˆç®€å•ï¼
**æ‰«ä¸€æ‰«ä¸‹é¢äºŒç»´ç **ï¼Œä¸€é”®å…³æ³¨å…¬ä¼—å·ï¼Œå¼€å¯ä½ çš„æŠ€æœ¯å­¦ä¹ ä¹‹æ—…ï¼

![](https://files.mdnice.com/user/71186/0dde803d-d52f-4ed8-b74b-b7f3da5817b9.png)

å¦å¤–ï¼Œæˆ‘è¿˜å»ºäº†ä¸€ä¸ª**æŠ€æœ¯äº¤æµç¾¤**ï¼Œé‡Œé¢éƒ½æ˜¯è®¤çœŸå†™ä»£ç çš„å°ä¼™ä¼´ï¼Œä¸å¹ç‰›ã€ä¸é—²èŠï¼ŒåªèŠæŠ€æœ¯ã€‚  
æœ‰é—®é¢˜ï¼Ÿå¤§å®¶ä¸€å—å„¿è®¨è®ºï¼Œæ¯”ä¸€ä¸ªäººé—·å¤´å­¦æ•ˆç‡é«˜å¤šäº†ï¼

![](https://files.mdnice.com/user/48364/4ebc72e9-e4bb-447a-9a92-8367a178df6d.png)

æŠ€æœ¯è¿™æ¡è·¯ï¼Œä¸€ä¸ªäººèµ°å®¹æ˜“è¿·è·¯ï¼Œä¸€ç¾¤äººèµ°æ‰æœ‰æ–¹å‘ã€‚  
è·Ÿä¸ŠèŠ‚å¥ï¼Œæˆ‘ä»¬ä¸€èµ·å˜å¼º ğŸ’ª